try{!function(){let e,t="getGamePerformanceUtilsSDKGlobalVar";globalThis[t]?e=globalThis[t]:void 0!==globalThis.WeixinJSBridge&&globalThis.WeixinJSBridge[t]&&(e=globalThis.WeixinJSBridge[t]);var{wxConsole:n}=e();(()=>{var e={715:e=>{function t(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,s){var o=e.apply(n,r);function a(e){t(o,i,s,a,l,"next",e)}function l(e){t(o,i,s,a,l,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{"use strict";n.d(r,{default:()=>Tn});var e=n(715),t=n.n(e);class i{static getInstance(){return this.instance||(this.instance=new this),this.instance}}i.instance=void 0;var s,o,a,l,h,c,u,d,f=null;function p(){return f}function g(){return u}function m(){return d}function v(){return a}function I(e){return"number"==typeof e&&isFinite(e)}function y(e){return e.then((e=>[null,e])).catch((e=>[e,null]))}function k(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return!e;if(e instanceof Error)return""===e.message;switch(Object.prototype.toString.call(e)){case"[object String]":case"[object Array]":return!e.length;case"[object File]":case"[object Map]":case"[object Set]":return!e.size;case"[object Object]":return!Object.keys(e).length}return!1}function w(e){return"[object String]"===Object.prototype.toString.call(e)}function b(e){return void 0===e}function T(e){var t=e;try{"object"==typeof e&&(t="string"==typeof e.errMsg?e.errMsg:"string"==typeof e.errmsg?e.errmsg:"string"==typeof e.message?e.message:JSON.stringify(e))}catch(e){console.error(e)}return t}const S=class extends i{constructor(...e){super(...e),this.frameInfo=void 0,this.frame=0,this.requestId=void 0,this.startTime=0,this.prevTime=0}get currentFrame(){return this.frame+1}init(){this.startTime=Date.now(),this.start()}getRuntime(){return Date.now()-this.startTime}start(){this.requestId||(this.prevTime=Date.now(),requestAnimationFrame(this.counter.bind(this)))}stop(){cancelAnimationFrame(this.requestId),this.requestId=0}reset(){this.stop(),this.requestId=0,this.startTime=0,this.prevTime=0,this.frameInfo=null}counter(){this.frame+=1;var e=Date.now(),t=e-this.prevTime;this.frameInfo={frame:this.frame,startTime:this.prevTime,endTime:e,cost:t},this.prevTime=e,this.requestId=requestAnimationFrame(this.counter.bind(this))}}.getInstance();var C=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},R=20;function P(){this._events={},this._conf&&x.call(this,this._conf)}function x(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=void 0!==e.maxListeners?e.maxListeners:R,e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener)):this._maxListeners=R}function L(e,t){console.warn(`[Event] ${e} listeners of event ${t} have been added, possibly causing memory leak.`)}function _(e){this._events={},this._newListener=!1,this._removeListener=!1,x.call(this,e)}_.prototype.delimiter=".",_.prototype.setMaxListeners=function(e){void 0!==e&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},_.prototype.event="",_.prototype.once=function(e,t){return this._once(e,t,!1)},_.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},_.prototype._once=function(e,t,n){return this._many(e,1,t,n),this},_.prototype.many=function(e,t,n){return this._many(e,t,n,!1)},_.prototype.prependMany=function(e,t,n){return this._many(e,t,n,!0)},_.prototype._many=function(e,t,n,r){var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function s(){return 0==--t&&i.off(e,s),n.apply(this,arguments)}return s._origin=n,this._on(e,s,r),i},_.prototype.emit=function(){this._events||P.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,n,r,i,s,o=arguments.length;if(this._all&&this._all.length){if(s=this._all.slice(),o>3)for(t=new Array(o),i=0;i<o;i++)t[i]=arguments[i];for(r=0,n=s.length;r<n;r++)switch(this.event=e,o){case 1:s[r].call(this,e);break;case 2:s[r].call(this,e,arguments[1]);break;case 3:s[r].call(this,e,arguments[1],arguments[2]);break;default:s[r].apply(this,t)}}if("function"==typeof(s=this._events[e])){switch(this.event=e,o){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(o-1),i=1;i<o;i++)t[i-1]=arguments[i];s.apply(this,t)}return!0}if(s&&(s=s.slice()),s&&s.length){if(o>3)for(t=new Array(o-1),i=1;i<o;i++)t[i-1]=arguments[i];for(r=0,n=s.length;r<n;r++)switch(this.event=e,o){case 1:s[r].call(this);break;case 2:s[r].call(this,arguments[1]);break;case 3:s[r].call(this,arguments[1],arguments[2]);break;default:s[r].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},_.prototype.emitAsync=function(){this._events||P.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,r,i,s,o=[],a=arguments.length;if(this._all){if(a>3)for(t=new Array(a),i=1;i<a;i++)t[i]=arguments[i];for(r=0,n=this._all.length;r<n;r++)switch(this.event=e,a){case 1:o.push(this._all[r].call(this,e));break;case 2:o.push(this._all[r].call(this,e,arguments[1]));break;case 3:o.push(this._all[r].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[r].apply(this,t))}}if("function"==typeof(s=this._events[e]))switch(this.event=e,a){case 1:o.push(s.call(this));break;case 2:o.push(s.call(this,arguments[1]));break;case 3:o.push(s.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];o.push(s.apply(this,t))}else if(s&&s.length){if(s=s.slice(),a>3)for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];for(r=0,n=s.length;r<n;r++)switch(this.event=e,a){case 1:o.push(s[r].call(this));break;case 2:o.push(s[r].call(this,arguments[1]));break;case 3:o.push(s[r].call(this,arguments[1],arguments[2]));break;default:o.push(s[r].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},_.prototype.on=function(e,t){return this._on(e,t,!1)},_.prototype.prependListener=function(e,t){return this._on(e,t,!0)},_.prototype.onAny=function(e){return this._onAny(e,!1)},_.prototype.prependAny=function(e){return this._onAny(e,!0)},_.prototype.addListener=_.prototype.on,_.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},_.prototype._on=function(e,t,n){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||P.call(this),this._newListener&&this.emit("newListener",e,t),this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,L.call(this,this._events[e].length,e))):this._events[e]=t,this},_.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n});for(var i=0;i<r.length;i++){if(n=r[i]._listeners,C(n)){for(var s=-1,o=0,a=n.length;o<a;o++)if(n[o]===t||n[o].listener&&n[o].listener===t||n[o]._origin&&n[o]._origin===t){s=o;break}if(s<0)continue;return this._events[e].splice(s,1),0===n.length&&delete this._events[e],this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return function e(t){if(void 0!==t){var n=Object.keys(t);for(var r in n){var i=n[r],s=t[i];s instanceof Function||"object"!=typeof s||null===s||(Object.keys(s).length>0&&e(t[i]),0===Object.keys(s).length&&delete t[i])}}}(this.listenerTree),this},_.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(n=0,r=(t=this._all).length;n<r;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,r=t.length;n<r;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},_.prototype.removeListener=_.prototype.off,_.prototype.removeAllListeners=function(e){return void 0===e?(!this._events||P.call(this),this):(this._events&&delete this._events[e],this)},_.prototype.listeners=function(e){return this._events||P.call(this),this._events[e]||(this._events[e]=[]),C(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},_.prototype.eventNames=function(){return Object.keys(this._events)},_.prototype.listenerCount=function(e){return this.listeners(e).length},_.prototype.listenersAny=function(){return this._all?this._all:[]};const E=new _;var N=function(e){return e.LoadStart="wx-request-load-start",e.LoadFail="wx-reqeust-load-fail",e.LoadSuccess="wx-request-load-success",e.LoadComplete="wx-request-load-complete",e}({}),A=function(e){return e.Start="detect-start",e.End="detect-end",e.BeforeResult="detect-before-result",e}({}),F=function(e){return e.Received="performance-data-received",e}({}),D=function(e){return e.Drawcall="canvas-drawcall",e.TextureCompressionFormat="texture-compression-format",e.NoTextureCompressionFormat="no-texture-compression-format",e}({}),M=function(e){return e.Invoked="api-invoked",e.ReportInteraction="report-interaction",e.JsError="on-js-error",e.UnhandledPromiseRejection="unhandled-promise-rejection",e.FsApiInvoked="fs-api-invoked",e}({}),q=new Map;["markScene","getSystemInfo","getWindowInfo","getSystemSetting","getDeviceInfo","getAppBaseInfo","getAppAuthorizeSetting","triggerGC","getMenuButtonBoundingClientRect","revokeBufferURL","createBufferURL","reportMonitor","reportEvent","createPath2D","createCanvas","setPreferredFramesPerSecond","loadFont","createImageData","createImage","setCursor","requestPointerLock","isPointerLocked","exitPointerLock","createWebAudioContext","createInnerAudioContext","createVideoDecoder","createWorker","encode","decode"].forEach((e=>{q.set(e,!0)}));const W=q;function G(e,t){return e?e[t]||e[t.toLowerCase()]:""}function O(e,t){var n=null;for(var r of e.children){var i;if((null==r||null===(i=r.attributes)||void 0===i?void 0:i.id)===t){n=r;break}if(r.children.length>0){var s=O(r,t);if(null!==s){n=s;break}}}return n}function j(e,t=[]){var n=new WeakMap,r=JSON.stringify(e,((e,r)=>{if(!t.includes(e)){var i=r&&r.buffer instanceof ArrayBuffer&&void 0!==r.BYTES_PER_ELEMENT;if(!("function"==typeof r||Array.isArray(r)||r instanceof ArrayBuffer||i||r instanceof Map||r instanceof Set)){if("object"==typeof r&&null!==r){if(n.has(r))return;n.set(r,!0)}return r}}}));return"{}"===r?"":r}function B(e){return e>=200&&e<300}var V=["getPrivacyState","getPrivacyState","createOpenSettingButton","onLaunch","offLaunch","gameLoginReport","gameLogoutReport","initFaceDetect","faceDetect","stopFaceDetect","createGamePortal","createGameBanner","createGameIcon","getSavedFileList","getSavedFileInfo","removeSavedFile"];class U{constructor(e){var t;this.invokeInfo=void 0,this.args=null,this.result=null,this.isSyncApi=!1,this.isDeprecated=!1,this.ret=null,this.recorded=!1;var{apiName:n,args:r}=e,i=Date.now(),s=Math.random();this.isDeprecated=this.checkIsDeprecatedApi(n),this.args=r,this.invokeInfo={frame:S.currentFrame,uniqueId:1e4*i+Math.round(9999*s),startTime:i,endTime:0,args:null==r||null===(t=r.map((e=>j(e))))||void 0===t?void 0:t.filter((e=>!!e)),apiName:n,errno:0,invokeCost:0,callbackDuration:0,errMsg:"",isSyncApi:this.checkIsSyncApi(n)}}afterExecute(e){e&&(this.ret=e),this.invokeInfo.invokeCost=Date.now()-this.invokeInfo.startTime,this.sendMessage()}complete(e){var{endTime:t}=this.invokeInfo;if(!t){var n=Date.now();this.invokeInfo.endTime=n,this.invokeInfo.callbackDuration=n-this.invokeInfo.startTime}this.result||(this.result=e);var{errMsg:r,errno:i}=e;r&&!r.includes(":ok")&&(this.invokeInfo.errMsg=r,this.invokeInfo.errno=b(i)?1:i)}sendMessage(){this.recorded||(this.recorded=!0,E.emit(M.Invoked,this))}checkIsSyncApi(e){return e.toLowerCase().endsWith("sync")&&!e.toLowerCase().endsWith("async")||(null==W?void 0:W.has(e))}checkIsDeprecatedApi(e){return V.includes(e)}}var K=function(e){return e[e.None=0]="None",e[e.Event=1]="Event",e[e.Error=2]="Error",e[e.Warn=3]="Warn",e[e.Info=4]="Info",e[e.Debug=5]="Debug",e}(K||{});class ${static error(...e){$.logLevel>=K.Error&&console.error("[DETECT ERROR]",...e)}static warn(...e){$.logLevel>=K.Warn&&console.warn("[DETECT WARN]",...e)}static info(...e){$.logLevel>=K.Info&&console.info("[DETECT INFO]",...e)}static event(...e){$.logLevel>=K.Event&&console.info("[DETECT EVENT]",...e)}static debug(...e){$.logLevel>=K.Debug&&console.log("[DETECT DEBUG]",...e)}static setLogLevel(e){$.logLevel=e}static getLogLevel(){return $.logLevel}}$.logLevel=K.Warn;var H=class extends i{constructor(...e){super(...e),this.injectTime=0,this.detectTimes=0,this.showTimes=0,this.lastTimeStamp=0,this.initParams=void 0,this.isWxApplib=!1,this.sdk={},this.meta={startTime:0,endTime:0,uploadTime:0,launchTime:0,isAutoStart:!1,sdkVersion:""},this.defaultMaxConcurrent=10,this.onShow=()=>{this.showTimes+=1,$.debug("return front end after ",Date.now()-this.lastTimeStamp," ms"),this.lastTimeStamp=0},this.onHide=()=>{this.lastTimeStamp=Date.now()}}get hasWXConfig(){return this.isWxApplib&&this.sdk.WXConfig}get audits(){return this.hasWXConfig&&this.sdk.WXConfig.audits||{}}get iOSHighPerformance(){return!!this.hasWXConfig&&(!!this.sdk.WXConfig.jitMode||!!this.sdk.WXConfig.iOSHighPerformance)}get maxConcurrentCount(){var e;return this.hasWXConfig&&(null===(e=this.sdk.WXConfig.wxAppInfo)||void 0===e?void 0:e.maxRequestConcurrent)||this.defaultMaxConcurrent}get subpackages(){return this.hasWXConfig?this.sdk.WXConfig.subpackages:[]}get parallelPreloadSubpackages(){return this.hasWXConfig?this.sdk.WXConfig.parallelPreloadSubpackages:[]}get isIOS(){return"ios"===this.sdk.WXConfig.platform}get isDevtools(){return"devtools"===this.sdk.WXConfig.platform}get isAndroid(){return"android"===this.sdk.WXConfig.platform}get showUI(){return!this.initParams.gameAuditModule}get enableByClient(){return this.initParams.enableByClient}init(e){if(this.initParams=e,this.injectTime=Date.now(),void 0!==this.initParams.WXConfig){this.isWxApplib=!0;var t=e;this.sdk={WXConfig:t.WXConfig,wxConsole:t.wxConsole,onShow:t.onShow,onHide:t.onHide,offShow:t.offShow,offHide:t.offHide,getSystemInfoSync:t.getSystemInfoSync,getNetworkType:t.getNetworkType,onNetworkStatusChange:t.onNetworkStatusChange,gameTransfer:t.gameTransfer,reportKeyValue:t.reportKeyValue,emitGameAuditStateChange:t.emitGameAuditStateChange}}else this.isWxApplib=!1;this.reset(),this.bindVisibleListener()}reset(){this.showTimes=0,this.meta={startTime:0,endTime:0,uploadTime:0,isAutoStart:!(this.detectTimes>0)&&H.audits.autoStart,launchTime:this.injectTime,sdkVersion:H.sdk.WXConfig.SDKVersion},this.removeVisibleListener()}bindVisibleListener(){this.sdk.onShow&&(this.sdk.onShow(this.onShow),this.sdk.onHide(this.onHide))}removeVisibleListener(){this.sdk.offShow&&(this.sdk.offShow(this.onShow),this.sdk.offHide(this.onHide))}}.getInstance(),J=new WeakMap,z=[];var Q=new class{get requestingCount(){return this.networkInfo.requestingCount}get needPushQueue(){var{requestingCount:e,maxConcurrent:t}=this.networkInfo;return e>t}constructor(){this.networkInfo=void 0,this.reset()}reset(){this.networkInfo={invokeCount:0,failCount:0,responseSize:0,requestingCount:0,requestStartTime:0,totalNetworkTime:0,maxConcurrent:H.maxConcurrentCount,maxRequestingCount:0,totalQueueCount:0,totalQueueTime:0},J=new WeakMap,z=[]}loadStart(e){bn.isRunning&&(0===this.networkInfo.requestingCount&&(this.networkInfo.requestStartTime=Date.now()),this.networkInfo.requestingCount+=1,this.networkInfo.invokeCount+=1,this.networkInfo.requestingCount>this.networkInfo.maxRequestingCount&&(this.networkInfo.maxRequestingCount=this.requestingCount),this.needPushQueue&&(this.networkInfo.totalQueueCount+=1,z.push(e),J.set(e,[Date.now()])))}loadSuccess(e){bn.isRunning&&this.handleInfo(e)}loadFail(e){bn.isRunning&&(this.networkInfo.failCount+=1,this.handleInfo(e))}handleInfo(e){var{networkInfo:t}=e,n=e.result;if(this.networkInfo.requestingCount>0){if(this.networkInfo.requestingCount-=1,0===this.networkInfo.requestingCount){var r=Date.now()-this.networkInfo.requestStartTime;this.networkInfo.totalNetworkTime+=r,$.debug("all network finished, cost=",r,", total=",this.networkInfo.totalNetworkTime)}this.networkInfo.responseSize+=t.byteLength,n&&!B(n.statusCode)&&($.error("network task statusCode error, statusCode=",n.statusCode,", url=",e.networkInfo.url),this.networkInfo.failCount+=1),this.calculateQueueTime(),$.debug("network task complete, currentInfo=",JSON.parse(JSON.stringify(this.networkInfo)))}}calculateQueueTime(){var e=z.length;if(e>0){var t=z.shift();if(t){var n=(J.get(t)||[])[0];if(n&&n>0){var r=Date.now()-n;J.set(t,[n,r,e]),this.networkInfo.totalQueueTime+=r}}}}},X={Request:"request",DownloadFile:"downloadFile",CreateImage:"createImage",CreateCanvas:"createCanvas",ReportScene:"reportScene",GetFileSystemManager:"getFileSystemManager",GetGameAudits:"getGameAudits"},Y={Env:"env",Cloud:"cloud"};class Z{constructor(e){this.type=void 0,this.networkInfo=void 0,this.invokeInfoMap=new WeakMap,this.result=void 0,this.needPushQueue=!1;var{generalInvokeInfo:t,type:n,args:r={}}=e,{url:i}=r;this.type=n,this.invokeInfoMap.set(this,t),t.result&&(this.result=t.result),this.networkInfo={url:i,byteLength:0,duration:0,currentConcurrentCount:Q.requestingCount,args:j(r,["data","url"]),statusCode:0,method:r.method,protocol:"",contentEncoding:"",cache:!0,queueTime:0},this.needPushQueue=Q.needPushQueue}complete(){var e=this.invokeInfoMap.get(this);e&&(e.result&&(this.result=e.result,this.networkInfo.statusCode=this.result.statusCode,this.networkInfo.protocol=this.result.profile?this.result.profile.protocol:"",this.type===X.Request?this.checkRequest():this.type===X.DownloadFile&&this.setResponseSize(this.result),this.calculateQueueTime(e)),this.type===X.CreateImage&&(this.networkInfo.statusCode=200))}calculateQueueTime(e){if(this.needPushQueue){var t=J.get(e)||[];t&&t[1]&&([,this.networkInfo.queueTime,this.networkInfo.queueLength]=t)}}checkRequest(){var e=this.result;B(e.statusCode)&&(this.checkHeader(e.header),this.setResponseSize(e))}checkHeader(e){e&&(this.networkInfo.contentEncoding=G(e,"Content-Encoding"),this.networkInfo.cache=this.checkCache(e),this.networkInfo.byteLength=parseInt(G(e,"Content-Length"),10)||0)}checkCache(e){var t=!0;if(e){var n=G(e,"X-Cache-Lookup")||G(e,"X-Cache"),r=G(e,"Age"),i=(n||"").toLowerCase();i?t=i.includes("hit"):r&&(t=Number(r)>0)}return t}setResponseSize(e){var{profile:t}=e,n=this.networkInfo.byteLength;return t?(n=t.receivedBytedCount,this.networkInfo.duration=t.responseEnd-t.requestStart):this.type===X.Request&&(n=this.getResponseSizeByBody(e)),this.networkInfo.byteLength=n,n}getResponseSizeByBody(e){var{data:t}=e,n=0;return w(t)?n=t.length:t&&t.byteLength&&(n=t.byteLength),n}}class ee{constructor(e){this.performanceInfo=void 0;var t=Date.now(),n=Math.random();this.performanceInfo={...e,uniqueId:1e4*t+Math.round(9999*n),frame:S.currentFrame,startTime:t,endTime:t}}}var te=["getNetworkType","getSystemInfoAsync"];function ne(e,t,n,...r){var i,s,o=new U({apiName:e,args:r}),a=null==r?void 0:r[0];if(a&&"object"==typeof a){var l=null==a?void 0:a.success;a.success=function(e){var t,r;o.complete(e),null==n||null===(t=n.success)||void 0===t||t.call(n,o),"function"==typeof l&&l.call(a,e),null==n||null===(r=n.afterSuccess)||void 0===r||r.call(n,o)};var h=null==a?void 0:a.fail;if(a.fail=function(e){var t,r;o.complete(e),null==n||null===(t=n.fail)||void 0===t||t.call(n,o),"function"==typeof h&&h.call(a,e),null==n||null===(r=n.afterFail)||void 0===r||r.call(n,o)},!te.includes(e)){var c=null==a?void 0:a.complete;a.complete=function(e){var t,r;o.complete(e),null==n||null===(t=n.complete)||void 0===t||t.call(n,o),"function"==typeof c&&c.call(a,e),null==n||null===(r=n.afterComplete)||void 0===r||r.call(n,o)}}}null==n||null===(i=n.beforeExecute)||void 0===i||i.call(n,o);var u=t(...r);return o.ret=u,null==n||null===(s=n.afterExecute)||void 0===s||s.call(n,o),o.afterExecute(u),u}var re=new WeakMap;var ie=new WeakMap;new WeakMap;var se=new WeakMap;new WeakMap,Object.prototype.__defineGetter__,Object.prototype.__defineSetter__,Object.defineProperty;var oe=null,ae=new WeakMap,le=!1;function he(){var e=p(),t=X.CreateCanvas,n=e.createCanvas;Object.defineProperties(e,{[t]:{value:()=>ne(t,n,{afterExecute:e=>{var{ret:t}=e;le||(le=!0);var n=t.getContext;t.getContext=function(e,r){var i=n.apply(t,[e,r]);return"2d"===e&&function(e){var t,n,r,i,s=["drawImage"],o=["fillText","strokeText"],a=["fillRect","strokeRect","beginPath","closePath","moveTo","lineTo","arc","quadraticCurveTo","clip"],l=null===(t=H.audits)||void 0===t||null===(n=t.rules)||void 0===n?void 0:n.disableFillText,h=null===(r=H.audits)||void 0===r||null===(i=r.rules)||void 0===i?void 0:i.disableCreateImage;!b(l)&&l||a.push(...o);!b(h)&&h||a.push(...s);s.forEach((t=>{var n=e[t];Reflect.defineProperty(e,t,{value:(...r)=>"drawImage"===t?function(e,t){return(...n)=>{var r;null!=n&&null!==(r=n[0])&&void 0!==r&&r.__image__&&(n[0]=se.get(n[0])),t.call(e,...n)}}(e,n).apply(e,r):n.apply(e,r),configurable:!0})}))}(i),"webgl"!==e&&"webgl2"!==e||function(e,t){var n,r,i=["drawArrays","drawElements"];if("webgl2"===t){var s=["drawElementsInstanced","drawArraysInstanced"];i.push(...s)}var o=null===(n=H.audits)||void 0===n||null===(r=n.rules)||void 0===r?void 0:r.disableCreateImage;!b(o)&&o||function(e,t){var n=["texImage2D","texSubImage2D","compressedTexImage2D","compressedTexSubImage2D"],r=["texImage3D","texSubImage3D","compressedTexImage3D","compressedTexSubImage3D"];"webgl2"===t&&n.push(...r);var i=function(e){oe||(oe={DXT:!!e.getExtension("WEBGL_compressed_texture_s3tc")||!!e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),ETC:!!e.getExtension("WEBGL_compressed_texture_etc"),PVRTC:!!e.getExtension("WEBGL_compressed_texture_pvrtc"),ASTC:!!e.getExtension("WEBGL_compressed_texture_astc")});return oe}(e),s=Object.create(null);n.forEach((t=>{var n=e[t];s[t]={value(...r){if(r.length&&bn.isRunning&&le){var s=2;"texSubImage2D"===t&&(s=7===r.length?4:6),"compressedTexSubImage2D"===t&&(s=6);var o=function(e){if(e>=33776&&e<=33779||e>=35916&&e<=35919)return"DXT";if(e>=37488&&e<=37497||36196===e)return"ETC";if(e>=35840&&e<=35843)return"PVRTC";if(e>=37808&&e<=37821||e>=37840&&e<=37853)return"ASTC";return"Unknown"}(r[s]),a=function(e){var t;switch(e.length){case 6:t=5;break;case 9:t=8;break;case 7:t=6;break;case 8:t=7;break;default:return-1}return t}(r);a>-1&&r[a]&&!ae.has(r[a])&&(ae.set(r[a],!0),"Unknown"!==o?E.emit(D.NoTextureCompressionFormat):i[o]||E.emit(D.TextureCompressionFormat))}return r&&(r[5]&&r[5].__image__&&(r[5]=se.get(r[5])),r[6]&&r[6].__image__&&(r[6]=se.get(r[6])),r[7]&&r[7].__image__&&(r[7]=se.get(r[7])),r[8]&&r[8].__image__&&(r[8]=se.get(r[8]))),n.apply(e,r)},configurable:!0},Object.defineProperties(e,s)}))}(e,t)}(i,e),i}}}),configurable:!0}})}var ce=(e,t,n=!0)=>{var r=e;n&&(r.on("touchstart",(()=>{r.style.opacity=.5})),r.on("touchend",(()=>{r.style.opacity=1}))),r.on("click",(e=>{(e=>{var t=e.absoluteX,n=e.absoluteY,r=e.absoluteEndX,i=e.absoluteEndY,s=e.pressInterval,o=!1;return Math.abs(i-n)<30&&Math.abs(r-t)<30&&s<300&&(o=!0),o})(e)&&t()}))};var ue,de,fe,pe,ge=32,me={body:{zIndex:1000009,position:"absolute",overflow:"visible",hidden:!1,width:76,height:ge,top:200,left:0},container:{position:"absolute",overflow:"visible",hidden:!1,width:76,height:ge,backgroundColor:"#00000080",borderRadius:16},operateBtn:{position:"absolute",left:24,top:0,width:44,height:ge,lineHeight:ge,textAlign:"center",color:"#ffffff",fontSize:11},stopIcon:{position:"absolute",width:7.5,height:12.5,left:9.83,top:9.75,hidden:!0},startIcon:{position:"absolute",width:10.82,height:12.13,top:9.4,left:9,hidden:!0},touchMask:{zIndex:1000009,position:"absolute",overflow:"hidden",hidden:!1,width:76,height:ge,backgroundColor:"rgba(0, 0, 0, 0)"}},ve={Launch:"auditStart",End:"auditEnd",WriteReport:"writeReport",UploadReport:"uploadReport",AddEveluationReport:"addEveluationReport",OnHide:"onHide",OnShow:"onShow",RemoveReportFile:"removeReportFile",GetAuthToken:"getAuthToken"},Ie={Self:0,Devtools:1};class ye{static start(e){if(!ye.timeMap.has(e)){var t=Date.now();return ye.timeMap.set(e,t),t}return 0}static timeEnd(e){if(ye.timeMap.has(e)){var t=Date.now(),n=ye.timeMap.get(e);return ye.timeMap.delete(e),t-n}return 0}}ye.timeMap=new Map,function(e){e[e.Front=1]="Front",e[e.Background=2]="Background"}(ue||(ue={})),function(e){e[e.Default=0]="Default",e[e.GameTransfer=1]="GameTransfer",e[e.Request=2]="Request",e[e.DownloadFile=3]="DownloadFile",e[e.CgiSpeedMeasure=4]="CgiSpeedMeasure",e[e.BadJs=5]="BadJs",e[e.Init=6]="Init",e[e.CostTime=7]="CostTime",e[e.Error=8]="Error",e[e.UploadFile=9]="UploadFile",e[e.Login=10]="Login",e[e.WebTransfer=11]="WebTransfer"}(de||(de={})),function(e){e[e.Info=101]="Info",e[e.Warn=102]="Warn",e[e.Error=103]="Error"}(fe||(fe={})),function(e){e.GameTransferReport="GameTransferReport",e.KeyValueReport="KeyValueReport",e.WxRequestReport="WxRequestReport"}(pe||(pe={}));var ke,we,be=Object.values(de).filter((e=>I(e)));!function(e){e.STRING="STRING",e.LONGLONG="LONGLONG",e.UINT="UINT",e.INT="INT"}(ke||(ke={})),function(e){e.SvrReport="SvrReport",e.KvStat="KvStat"}(we||(we={}));var Te={[ke.STRING]:e=>"string"==typeof e&&e.length<=1024,[ke.LONGLONG]:e=>"number"==typeof e&&Math.floor(e)===e,[ke.UINT]:e=>"number"==typeof e&&Math.floor(e)===e&&e>=0,[ke.INT]:e=>"number"==typeof e&&Math.floor(e)===e};class Se{constructor({logid:e,schemas:t={},base:n,debug:r=!1,namespace:i="",skipValidateInProdEnv:s=!0}){this.debug=!1,this.base={},this.namespace="",this.skipValidateInProdEnv=!0,this.asyncGetBase=()=>Promise.resolve({}),this.logid=e,this.schemas=t,n&&this.setBase(n),this.debug=r,this.skipValidateInProdEnv=s,this.namespace=i?` ${i} `:" "}setBase(e){this.validate(e),this.base=Object.assign(Object.assign({},this.base),e)}validate(e){if((this.debug||!this.skipValidateInProdEnv)&&Object.keys(this.schemas).length)for(var[t,n]of Object.entries(e))if(void 0!==n){var r=this.schemas[t];r?this.validateColumn(r,n)||console.error(`[minigamefe${this.namespace}SchemaValidator]: logid ${this.logid}: ${t} should be ${r}, but now ${n}`):console.warn(`[minigamefe${this.namespace}SchemaValidator]: logid${this.logid}: ${t} 缺少类型定义`)}}validateColumn(e,t){return Te[e](t)}}var Ce="";var Re,Pe,xe,Le,_e,Ee={19283:"GameComponent",19335:"GameWhatsNew",20285:"MidasFriendPayment",21494:"WXGameWASMLaunchClose",21493:"WXGameWASMLaunchException",21492:"WXGameWASMLaunchTime",21898:"GameLifeMiniGameCardAction",20267:"GameAdsSkipCard"};class Ne extends Se{constructor({reportFunc:e,logid:t,protocolParams:n,schemas:r,base:i,asyncGetBase:s=(()=>Promise.resolve({})),debug:o,namespace:a="",skipValidateInProdEnv:l=!0}){var h=t;"number"==typeof t&&Ee[t]&&(h=Ee[t],o&&console.warn(`[minigamefe${a?` ${a} `:" "}KeyValueReporter]: logid ${t} auto map to ${h}!`)),super({logid:h,schemas:r,base:i,debug:o,namespace:a,skipValidateInProdEnv:l}),this.asyncGetBase=s,e||console.error(`[minigamefe${this.namespace}KeyValueReporter]: 未传入上报函数。`),this.reportFunc=e||function(){},this.protocolParams=n,this.sendCbk=null}setAppInfoBase(e){Object.assign(this.schemas,{AppId:ke.STRING,AppVersion:ke.UINT,AppState:ke.UINT}),this.protocolParams.unshift("AppId","AppVersion","AppState"),this.setBase(e)}send(e,t){var n;n=Array.isArray(e)?e:[e],this.asyncGetBase().then((e=>{this.setBase(e),n.forEach((e=>{var n=Object.assign(Object.assign({},this.base),e);this.validate(n);var r=[];this.protocolParams.forEach((e=>{var t=void 0!==n[e]?n[e]:"";r.push(t)})),this.reportFunc({key:this.logid,value:r.map(encodeURIComponent).join(","),immediately:!0});var i=t||this.sendCbk;(i&&i(this.logid,r.map(encodeURIComponent).join(",")),this.debug)&&(n.IsError?console.error:console.log)(`[minigamefe${this.namespace}keyValueReport]: ${this.logid}`,n)}))}))}}!function(e){e.devtools="devtools",e.android="android",e.ios="ios",e.windows="windows",e.mac="mac"}(Re||(Re={})),function(e){e.portrait="portrait",e.landscape="landscape",e.landscapeLeft="landscapeLeft",e.landscapeRight="landscapeRight"}(Pe||(Pe={})),function(e){e.DEVELOP="develop",e.TRIAL="trial",e.RELEASE="release"}(xe||(xe={})),function(e){e[e.release=1]="release",e[e.develop=2]="develop",e[e.trial=3]="trial"}(Le||(Le={})),function(e){e[e.Android=0]="Android",e[e.IOSJscore=1]="IOSJscore",e[e.IOSWK=2]="IOSWK",e[e.UnKnow=3]="UnKnow",e[e.PC=4]="PC",e[e.Devtools=5]="Devtools",e[e.IPadJscore=6]="IPadJscore",e[e.IPadWK=7]="IPadWK",e[e.IOSWKPlus=8]="IOSWKPlus",e[e.IPadWKPlus=9]="IPadWKPlus"}(_e||(_e={}));class Ae extends Se{constructor({reportFunc:e,logid:t,schemas:n={},base:r,reportType:i,asyncGetBase:s=(()=>Promise.resolve({})),debug:o,namespace:a="",skipValidateInProdEnv:l=!0}){super({logid:t,schemas:n,base:r,debug:o,namespace:a,skipValidateInProdEnv:l}),this.reportType=we.SvrReport,this.asyncGetBase=s,e||console.error(`[minigamefe${this.namespace}GameTransferReport]: 未传入上报函数。`),this.reportFunc=e,void 0!==i&&(this.reportType=i)}setKvStatBase(e,t){if(this.reportType===we.KvStat){var n=(e.system||"").split(" ");Object.assign(this.schemas,{DeviceModel:ke.STRING,DeviceBrand:ke.STRING,OsName:ke.STRING,OsVersion:ke.STRING,LanguageVersion:ke.STRING,Count:ke.UINT,AppId:ke.STRING,AppVersion:ke.UINT,AppState:ke.UINT}),this.setBase({DeviceModel:e.model||"",DeviceBrand:e.brand||"",OsName:n[0]||"",OsVersion:n[1]||"",LanguageVersion:e.language||"",Count:1}),(null==t?void 0:t.miniProgram)&&this.setBase({AppState:Le[t.miniProgram.envVersion]||Le.release,AppId:t.miniProgram.appId,AppVersion:0})}}send(e,t){if(this.reportFunc&&"function"==typeof this.reportFunc){var n,r=[],i=this.logid;n=Array.isArray(e)?e:[e],this.asyncGetBase().then((e=>{this.setBase(e),n.forEach((e=>{var t=Object.assign(Object.assign({},this.base),e);if(t.ExternInfo&&"object"==typeof t.ExternInfo&&this.schemas.ExternInfo===ke.STRING&&(t.ExternInfo=encodeURIComponent(JSON.stringify(t.ExternInfo))),this.validate(t),this.reportType===we.KvStat){var n=Math.floor(Date.now()/1e3);Object.assign(t,{StartTime:n,EndTime:n})}var s={log_id:this.logid,custom_data:t};r.push(s),this.debug&&console.log(`[minigamefe${this.namespace}GameTransferReport]: ${i},`,t)}));var s={report_list:r};this.reportFunc({req_path:"comm_datareport",json_data:JSON.stringify(s),success(){t&&t(i,JSON.stringify(s))},fail(e){console.error(e),t&&t(i,T(e))}})}))}else console.error("[minigamefe GameTransferReport]: 未传入上报函数!!!")}}class Fe extends Se{constructor({reportFunc:e,logid:t,schemas:n={},base:r,debug:i,namespace:s,asyncGetBase:o=(()=>Promise.resolve({})),reportType:a,skipValidateInProdEnv:l=!0}){super({logid:t,schemas:n,base:r,debug:i,namespace:s,skipValidateInProdEnv:l}),this.reportType=we.SvrReport,this.reportFunc=e,e||console.error(`[minigamefe${this.namespace}RequestReport]: 未传入上报函数。`),this.asyncGetBase=o,void 0!==a&&(this.reportType=a)}setKvStatBase(e,t){if(this.reportType===we.KvStat){var n=(e.system||"").split(" ");Object.assign(this.schemas,{DeviceModel:ke.STRING,DeviceBrand:ke.STRING,OsName:ke.STRING,OsVersion:ke.STRING,LanguageVersion:ke.STRING,Count:ke.UINT,AppId:ke.STRING,AppVersion:ke.UINT,AppState:ke.UINT}),this.setBase({DeviceModel:e.model||"",DeviceBrand:e.brand||"",OsName:n[0]||"",OsVersion:n[1]||"",LanguageVersion:e.language||"",Count:1}),(null==t?void 0:t.miniProgram)&&this.setBase({AppState:Le[t.miniProgram.envVersion]||Le.release,AppId:t.miniProgram.appId,AppVersion:0})}}send(e,t){if(this.reportFunc&&"function"==typeof this.reportFunc){var n,r=[],i=this.logid;n=Array.isArray(e)?e:[e],this.asyncGetBase().then((e=>{this.setBase(e),n.forEach((e=>{var t=Object.assign(Object.assign({},this.base),e);this.validate(t);var n={log_id:i,custom_data:t};r.push(n)}));var s=JSON.stringify({report_list:r});this.debug&&console.log(`[minigamefe${this.namespace}RequestReport]: ${i}`,...r),this.reportFunc({url:"https://game.weixin.qq.com/cgi-bin/comm/datareport",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:s,success(){t&&t(i,JSON.stringify(s))},fail(e){console.error(e),t&&t(i,T(e))}})}))}else console.error("[minigamefe RequestReport]: 未传入上报函数!!!")}}var De=["BenchmarkLevel","NetworkType","RuntimeType","PluginAppId","PluginVersion","Scene","SDKVersion","IsVisible","Type","Target","Params","Result","CostTime","ExternInfo","CustomKey1","CustomKey2","CustomKey3","IsError","FELibVersion","Query"],Me={BenchmarkLevel:ke.UINT,NetworkType:ke.STRING,RuntimeType:ke.UINT,PluginAppId:ke.STRING,PluginVersion:ke.STRING,Scene:ke.UINT,SDKVersion:ke.STRING,IsVisible:ke.UINT,Type:ke.UINT,Target:ke.STRING,Params:ke.STRING,Result:ke.STRING,CostTime:ke.UINT,ExternInfo:ke.STRING,CustomKey1:ke.STRING,CustomKey2:ke.STRING,CustomKey3:ke.STRING,IsError:ke.UINT,FELibVersion:ke.STRING,Query:ke.STRING};function qe(e){var t,{type:n=pe.KeyValueReport,reportKeyValue:r,debug:i,gameTransfer:s,systemInfo:o,accountInfo:a,getNetworkType:l,onNetworkStatusChange:h,request:c,namespace:u}=e,d="";function f(){return new Promise((e=>{d?e({NetworkType:d}):l({success:t=>{d=t.networkType,e({NetworkType:d})},fail:()=>{e({NetworkType:d="unknown"})}})}))}return n===pe.KeyValueReport?t=new Ne({reportFunc:r,logid:26340,schemas:Me,protocolParams:De,debug:i,namespace:u,asyncGetBase:f}):n===pe.GameTransferReport?(t=new Ae({reportFunc:s,logid:26340,schemas:Me,reportType:we.KvStat,debug:i,namespace:u,asyncGetBase:f})).setKvStatBase(o,a):(console.warn("[minigamefe]: 当前选择 reqeust 进行质量上报, 请自行确保兼容性"),(t=new Fe({reportFunc:c,logid:26340,schemas:Me,debug:i,namespace:u,asyncGetBase:f,reportType:we.KvStat})).setKvStatBase(o,a)),n!==pe.GameTransferReport&&n!==pe.WxRequestReport||function(e,t,n){Ce?e&&e(Ce):(t({success:t=>{Ce=t.networkType,e&&e(Ce)}}),n((t=>{Ce=t.networkType,t.isConnected||(Ce="none"),e&&e(Ce)})))}((e=>{d=e,t.setBase({NetworkType:e})}),l,h),t}function We(e,t){var n,r=e||"";if(n=r,"[object Object]"===Object.prototype.toString.call(n))try{r=JSON.stringify(r)}catch(e){console.error(`[minigamefe stringify error]: ${e}`),r=""}else r=String(r);return r.length&&r.length>=1024&&(r=r.substr(0,1024),console.warn(`[minigamefe stringify warning]: ${t} 上报长度超过1024, 已裁剪`)),r}class Ge{constructor(e){var t,r,i;this.benchmarkLevel=0,this.network="",this.runtimeType=_e.UnKnow,this.sdkVersion="0.0.0",this.isVisible=ue.Front,this.scene=0,this.query="",this.pluginAppId="",this.pluginVersion="",this.inited=!1;var{systemInfo:s,launchInfo:o,onShow:a,onHide:l,pluginAppId:h="",pluginVersion:c=""}=e;if(!a||!l)return console.error("[minigamefe stringify warning]: please inject QualityConfig correctly"),void(this.inited=!1);this.inited=!0,this.onShow=a,this.onHide=l,this.benchmarkLevel=(s.benchmarkLevel||1)+100,this.sdkVersion=s.SDKVersion||"0.0.0",this.launchInfo=o,this.scene=(null===(t=this.launchInfo)||void 0===t?void 0:t.scene)||0,k(null===(r=this.launchInfo)||void 0===r?void 0:r.query)||(this.query=encodeURIComponent(JSON.stringify(null===(i=this.launchInfo)||void 0===i?void 0:i.query))),this.runtimeType=function(e){var t,r,i,s,o,a=null===(t=e.platform)||void 0===t?void 0:t.toLocaleLowerCase();return a===Re.devtools?_e.Devtools:a===Re.ios?e.model&&e.model.indexOf("iPad")>-1?(null===(r=n.g)||void 0===r?void 0:r.isIOSHighPerformanceModePlus)?_e.IPadWKPlus:(null===(i=n.g)||void 0===i?void 0:i.isIOSHighPerformanceMode)?_e.IPadWK:_e.IPadJscore:(null===(s=n.g)||void 0===s?void 0:s.isIOSHighPerformanceModePlus)?_e.IOSWKPlus:(null===(o=n.g)||void 0===o?void 0:o.isIOSHighPerformanceMode)?_e.IOSWK:_e.IOSJscore:a===Re.android?_e.Android:a===Re.windows||a===Re.mac?_e.PC:_e.UnKnow}(s),this.pluginAppId=h,this.pluginVersion=c,this.bindNativeEvent(),this.reporter=qe(e),this.reporter.setBase({BenchmarkLevel:this.benchmarkLevel,RuntimeType:this.runtimeType,Scene:+this.scene,SDKVersion:this.sdkVersion,IsVisible:this.isVisible,PluginAppId:h,PluginVersion:c,FELibVersion:"1.1.67",Query:this.query})}bindNativeEvent(){this.onHide((()=>{this.isVisible=ue.Background,this.reporter.setBase({IsVisible:this.isVisible})})),this.onShow((e=>{k(null==e?void 0:e.query)||(this.query=encodeURIComponent(JSON.stringify(e.query))),this.isVisible=ue.Front,this.reporter.setBase({IsVisible:this.isVisible,Query:this.query})}))}innerReport(e){this.reporter.send(Object.assign(e,{CostTime:I(e.CostTime)?e.CostTime:0,Params:We(e.Params,"Params"),Result:We(e.Result,"Result"),ExternInfo:We(e.ExternInfo,"ExternInfo")}))}report(e){be.indexOf(e.Type)>-1&&console.error(`[minigamefe quality report]: 若为自定义上报, Type 请不要使用内置枚举值 ${e.Type}, 内置枚举可见 mgp.consts.ReportType`),this.inited&&this.innerReport(e)}setCustomKey(e){this.inited&&this.reporter.setBase({CustomKey1:e.CustomKey1&&We(e.CustomKey1,"CustomKey1")||"",CustomKey2:e.CustomKey2&&We(e.CustomKey2,"CustomKey2")||"",CustomKey3:e.CustomKey3&&We(e.CustomKey3,"CustomKey3")||""})}clearCustomKey(){this.inited&&this.reporter.setBase({CustomKey1:"",CustomKey2:"",CustomKey3:""})}}class Oe{constructor(){this.quality=void 0,this.inited=!1,this.initPromise=void 0,this.initPromise=this.initQuality()}initQuality(){return new Promise((e=>{H.sdk.WXConfig&&H.sdk.WXConfig.onReady((()=>{this.inited=!0,this.quality=new Ge({debug:!1,type:pe.KeyValueReport,pluginAppId:"wxapplib_Audits",pluginVersion:H.sdk.WXConfig.SDKVersion,launchInfo:H.sdk.WXConfig.appLaunchInfo,accountInfo:H.sdk.WXConfig.accountInfo,systemInfo:H.sdk.getSystemInfoSync(),onShow:H.sdk.onShow,onHide:H.sdk.onHide,getNetworkType:H.sdk.getNetworkType,onNetworkStatusChange:H.sdk.onNetworkStatusChange,gameTransfer:H.sdk.gameTransfer,reportKeyValue:H.sdk.reportKeyValue}),e(this.quality)}))}))}report(e){this.inited?this.quality.report(e):this.initPromise.then((()=>{this.quality.report(e)}))}}var je,Be,Ve=null;function Ue(){var e;return{autoStart:null===(e=H.sdk.WXConfig.audits)||void 0===e?void 0:e.autoStart,enableType:Ie.Self,showTimes:H.showTimes,detectTimes:H.detectTimes}}function Ke(e){H.isWxApplib&&Ve.report({Type:fe.Error,Target:ve.GetAuthToken,ExternInfo:{errMsg:String(e).slice(0,1024),...Ue()}})}var $e=!1,He="";function Je(e){e.gameTransfer&&(je=e.gameTransfer,$e=function(e="0.0.0",t){if("string"!=typeof e||"string"!=typeof t)return"string"!=typeof e&&"string"!=typeof t?0:"string"!=typeof e?1:-1;for(var n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length);n.length<i;)n.push("0");for(;r.length<i;)r.push("0");for(var s=0;s<i;s++){var o=parseInt(n[s],10),a=parseInt(r[s],10);if(o>a)return 1;if(o<a)return-1}return 0}(m().SDKVersion,"2.29.1")>=0),e.authRequest&&(Be=e.authRequest)}function ze(){He=""}var Qe=function(e){return e[e.NoPermission=-10000401]="NoPermission",e[e.LoginExpired=9]="LoginExpired",e}({}),Xe={[Qe.NoPermission]:"当前用户无权限",[Qe.LoginExpired]:"登录过期"};function Ye(){return new Promise(((e,t)=>{var n="unity.refreshcontexttoken",r={auth_payload:{}};if(He)return e(He);r.auth_payload.expired_time=60;var i={req_path:n,success:n=>{var r,i=n.data;if($.debug("auth res = ",n,", data=",i),null!=i&&null!==(r=i.rsp_list)&&void 0!==r&&r.length){var s=(i.rsp_list.find((e=>"auth_token"===e.key))||{}).value;if(s)return function({token:e,costTime:t}){H.isWxApplib&&Ve.report({Type:fe.Info,Target:ve.GetAuthToken,ExternInfo:{token:e,costTime:t,...Ue()}})}({token:s,costTime:ye.timeEnd(ve.GetAuthToken)}),$.debug("token=",s),He=encodeURIComponent(s),e(He)}var o="system error";Ke(o),t({errMsg:o})},fail:e=>{$.error("gametransfer auth error, ",e),ye.timeEnd(ve.GetAuthToken),Ke(e.errmsg||"get auth token failed"),t(e)}};$e?(i.reqData={req_path:n,...r},delete i.req_path):i={...i,...r},je&&(ye.start(ve.GetAuthToken),je(i))}))}function Ze(){return(Ze=t()((function*(){if(Be){var e=yield Be();return He=e,Promise.resolve(He)}return Promise.resolve()}))).apply(this,arguments)}function et(){return je?Ye():Be?function(){return Ze.apply(this,arguments)}():void 0}var tt,nt,rt="https://game.weixin.qq.com";function it(e){var t;$.debug(`before ${e.url} request, auth`),null===(t=et())||void 0===t||t.then((t=>{$.debug("request auth token=",t),e.url.includes("ticket")&&(e.url=e.url.substring(0,e.url.indexOf("?ticket"))),e.url=`${e.url}?ticket=${t}`,$.debug("before request, options=",e),tt(e)}))}function st(e){var t;$.debug(`before ${e.url} upload, auth`),null===(t=et())||void 0===t||t.then((t=>{$.debug("upload auth token=",t),e.url.includes("ticket")&&(e.url=e.url.substring(0,e.url.indexOf("?ticket"))),e.url=`${e.url}?ticket=${t}`,nt(e)}))}function ot(e){return t="/cgi-bin/gamewxagbdatawap/addgameevaluationreport",n={meta_info:e},new Promise(((e,r)=>{var i={url:`${rt}${t}`,method:"POST",data:{...n},success:n=>($.debug(`post ${t} success, res=`,n),200===n.statusCode?n.data.errcode===Qe.LoginExpired?(ze(),it(i)):e(n.data):r(n)),fail:e=>{$.error(`post ${t} failed, err=`,e),r(e)}};it(i)}));var t,n}function at(e){return t={url:"/cgi-bin/gamewxagbdatawap/uploadfile",filePath:e,name:"file"},new Promise(((e,n)=>{var{url:r,filePath:i,name:s}=t,o={url:`${rt}${r}`,filePath:i,name:s,success(t){if($.debug(`upload ${r} success, res=`,t),200===t.statusCode){var{data:i}=t;return"string"==typeof i&&(i=JSON.parse(i)),i.errcode===Qe.LoginExpired?(ze(),st(o)):e(i)}return n(t)},fail:e=>{$.error(`post ${r} failed, err=`,e),n(e)}};st(o)}));var t}var lt,ht=function(e){return e[e.iOS=1]="iOS",e[e.Android=2]="Android",e[e.iPad=13]="iPad",e[e.Mac=14]="Mac",e[e.Windows=15]="Windows",e[e.AndroidPad=28]="AndroidPad",e[e.Devtools=-1]="Devtools",e}({}),ct=(ht.iOS,ht.Android,ht.iPad,ht.Mac,ht.Windows,ht.AndroidPad,ht.Devtools,{ios:1,android:2,ipad:13,mac:14,windows:15,devtools:-1}),ut=function(e){return e[e.Launch=0]="Launch",e[e.Performance=1]="Performance",e[e.Practice=2]="Practice",e[e.Render=3]="Render",e[e.Compatibility=4]="Compatibility",e[e.WxAPI=5]="WxAPI",e}({}),dt=function(e){return e.Start="start",e.Performance="performance",e.Network="network",e.WxAPI="wxapi",e.Practice="practice",e.Compatibility="compatibility",e.Render="render",e}({}),ft=function(e){return e.Init="init",e.Resource="resource",e.Inject="inject",e.Context="context",e.Compile="compile",e}({}),pt=function(e){return e.DownloadPkg="DownloadPkg",e.ResourcePrepare="ResourcePrepare",e.FirstRender="FirstRender",e.JsInject="JsInject",e.StartupDone="startupDone",e.ResourcePrepareToStartUpDone="ResourcePrepareToStartUpDone",e.ContactCGI="ContactCGI",e.LaunchCGI="LaunchCGI",e.StartupToJsInject="StartupToJsInject",e.JSVMInit="JSVMInit",e}({}),gt={[pt.DownloadPkg]:ft.Resource,[pt.ResourcePrepare]:ft.Init,[pt.FirstRender]:ft.Init,[pt.JsInject]:ft.Inject,[pt.StartupDone]:ft.Init,[pt.ResourcePrepareToStartUpDone]:ft.Init,[pt.ContactCGI]:ft.Init,[pt.LaunchCGI]:ft.Init,[pt.StartupToJsInject]:ft.Init,[pt.JSVMInit]:ft.Init},mt=function(e){return e.longFirstMeaningfulPaint="long-first-meaningful-paint",e.longInteractionCost="long-interaction-cost",e}({}),vt=function(e){return e.highCpuUsage="high-cpu-usage",e.highMemoryUsage="high-memory-usage",e.highAverageFps="high-average-fps",e.highStutter="high-stutter",e}({}),It=function(e){return e.noIosHighPerformance="no-ios-high-performance",e.noHttp2="no-http2",e.noContentEncoding="no-content-encoding",e.noCdnCache="no-cdn-cache",e.noParallelDownload="no-parallel-download",e.noInteractionReport="no-interaction-report",e.largeNetworkResponse="large-network-response",e.lowNetworkLatencyRation="low-network-latency-ration",e.highNetworkQueueingLatency="high-network-queueing-latency",e.longSingleNetworkLatency="long-single-network",e.highSingleNetworkResponse="high-single-network-response",e.highNetworkQueueingCount="high-network-queueing-count",e}({}),yt=function(e){return e.highDrawcall="high-drawcall",e.noTextureCompression="no-texture-compression",e.incorrectTextureCompressionFormat="incorrect-texture-compression-format",e.unreleasedCanvas="unreleased-canvas",e}({}),kt=function(e){return e.noJsError="no-js-error",e.noUnhandledRejection="no-unhandled-rejection",e.noNetworkError="no-network-error",e.noNetworkStatusError="no-network-status-error",e}({}),wt=function(e){return e.deprecatedApis="deprecated-apis",e.noCacheApiCall="no-cache-api-call",e}({});lt||(lt={});var bt,Tt={[dt.Practice]:{type:dt.Practice,name:"最佳实践检测",description:"",subItems:[]},[dt.Performance]:{type:dt.Performance,name:"运行性能",description:"",subItems:[]},[dt.Start]:{type:dt.Start,name:"启动性能",description:"",subItems:[]},[dt.WxAPI]:{type:dt.WxAPI,name:"wx api",description:"",subItems:[]},[dt.Network]:{type:dt.Network,name:"网络性能",description:"",subItems:[]},[dt.Compatibility]:{type:dt.Compatibility,name:"兼容性",description:"",subItems:[]},[dt.Render]:{type:dt.Render,name:"渲染",description:"",subItems:[]}},St={[ut.Launch]:{[mt.longFirstMeaningfulPaint]:{metaInfo:{name:"首帧渲染时长过长",description:"降低小游戏的启动时长对于用户新进留存具有非常重要的价值。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start2.html"}],weight:8},headers:[{key:"cost",header:"首屏时间",uint:"ms"}],threshold:5150},[mt.longInteractionCost]:{metaInfo:{name:"降低游戏可交互时长",description:"建议优化游戏启动过程，尽可能减少游戏前置的资源下载，缩短游戏可交互时间，提升用户体验。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start-reportScene.html"}],weight:3},headers:[{key:"costTime",header:"可交互耗时",uint:"ms"}],threshold:11840}},[ut.Performance]:{[vt.highCpuUsage]:{metaInfo:{name:"CPU利用率过高",description:"CPU利用率过高较易引起游戏卡顿等问题，建议通过CPU Profile工具排查长耗时逻辑，通过worker等方式优化相关业务逻辑。",document:[{title:"问题排查工具",href:"https://developers.weixin.qq.com/minigame/dev/devtools/profile.html"}],weight:7},headers:[{key:"cpu",header:"平均CPU利用率",uint:"%"}],threshold:30},[vt.highMemoryUsage]:{metaInfo:{name:"内存占用过高",description:"游戏内存占用过高是影响游戏稳定性的最大因素，建议通过相关工具游戏内存问题。",document:[{title:"常见内存优化手段",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-memory-overview.html"}],weight:7},headers:[{key:"memory",header:"平均内存占用",uint:"MB"}],threshold:665600},[vt.highAverageFps]:{metaInfo:{name:"帧率过低",description:"较低的帧率将直接影响游戏体验的流畅度，可通过CPU Profile针对游戏场景排查长耗时任务，定位卡顿原因。",document:[{title:"问题排查工具",href:"https://developers.weixin.qq.com/minigame/dev/devtools/profile.html"}],weight:5},headers:[{key:"fps",header:"平均FPS"}],threshold:50},[vt.highStutter]:{metaInfo:{name:"卡顿率过高",description:"较高的卡顿率将影响游戏用户的实际游玩体验，可考虑适当降低帧率、优化游戏业务逻辑等手段来降低游戏卡顿问题。",document:[],weight:7},headers:[{key:"stutter",header:"卡顿率",uint:"%"}],threshold:1.5}},[ut.Practice]:{[It.noIosHighPerformance]:{metaInfo:{name:"使用高性能模式",description:"建议开启高性能模式，iOS设备下能拥有更好的渲染性能和表现。",weight:0,document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-high-performance.html"}]},threshold:!0},[It.noHttp2]:{metaInfo:{name:"使用HTTP/2",description:"建议服务器开启HTTP2.0，通过多路复用和头部压缩等的特性，能提升细碎文件的下载效率。",weight:8},headers:[{key:"url",header:"URL",width:"80%"},{key:"protocol",header:"协议"}],threshold:!0},[It.noContentEncoding]:{metaInfo:{name:"开启服务器压缩",description:"建议开启服务器压缩，尽可能对传输数据进行压缩，减少网络数据的传输体积。",document:[{title:"了解更多",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding"}],weight:10},headers:[{key:"url",header:"URL",width:"80%"},{key:"contentEncoding",header:"content-encoding"}],threshold:!0},[It.noCdnCache]:{metaInfo:{name:"使用CDN缓存",description:"发布新版本时，建议进行CDN预热，避免直接从源站拉取资源。",weight:10},headers:[{key:"url",header:"URL"}],threshold:!0},[It.noParallelDownload]:{metaInfo:{name:"使用并行下载",description:"建议使用小游戏分包的并行下载能力，提前下载后续游戏必要的分包资源，减少用户后续等待分包资源下载的时间，缩短用户进入游戏核心玩法的耗时。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start-parallel-download.html"}],weight:0},threshold:!0},[It.noInteractionReport]:{metaInfo:{name:"上报游戏可交互场景",description:"建议在游戏资源加载完毕时，上报用户的最早可操作游戏画面的时间点，用于统计游戏启动性能表现以及游戏启动留存情况。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start-reportScene.html"}],weight:0},threshold:!0},[It.largeNetworkResponse]:{metaInfo:{name:"合理控制网络请求总资源量",description:"减小网络请求资源量，过大的资源下载会增加用户启动耗时。",weight:5},headers:[{key:"byteLength",header:"总响应大小",uint:"MB"}],threshold:52428800},[It.lowNetworkLatencyRation]:{metaInfo:{name:"合理提升网络利用率",description:"网络利用率过低，未能在CPU密集时段，充分利用网络带宽，完成更多资源的下载。",weight:6},headers:[{key:"networkLatencyRation",header:"网络利用率",uint:"%"}],threshold:30},[It.highNetworkQueueingLatency]:{metaInfo:{name:"降低网络排队平均耗时",description:"网络排队平均耗时过高，排队超过一定时长会对用户体验造成影响。排队平均耗时过高有可能是由于请求并发量过大 或 网络请求耗时过长而导致导致，可通过网络请求模块进一步分析原因。",weight:6},headers:[{key:"networkQueueingLatency",header:"平均网络排队耗时",uint:"ms"}],threshold:1500},[It.longSingleNetworkLatency]:{metaInfo:{name:"降低单个网络请求耗时时长",description:"单个网络耗时过长，耗时过长会对用户体验造成影响。可以考虑使用CDN加速、开启HTTP/2、合理拆分资源等方式，减少网络请求的耗时。",weight:8},headers:[{key:"url",header:"URL",width:"80%"},{key:"callbackDuration",header:"网络耗时",uint:"ms"}],threshold:1500},[It.highSingleNetworkResponse]:{metaInfo:{name:"合理控制单个网络请求资源量",description:"网络请求体积大会导致请求的传输时间变长，影响用户体验。可适当将资源拆分进行按需下载、或开启数据压缩。",weight:3},headers:[{key:"url",header:"URL",width:"80%"},{key:"byteLength",header:"响应大小",uint:"MB"}],threshold:3145728},[It.highNetworkQueueingCount]:{metaInfo:{name:"减少网络排队数量",description:"网络请求排队过多将对用户体验造成影响，请进一步通过网络请求分析网络请求发起的并发量，可通过分帧请求的方式，将网络请求分散到不同帧内进行，或者实现为按需请求的方式进行。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/base-ability/network.html#%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6"}],weight:6},headers:[{key:"totalQueueCount",header:"总排队个数"}],threshold:50}},[ut.Render]:{[yt.highDrawcall]:{metaInfo:{name:"合理控制Drawcall",description:"建议使用合适手段减少Drawcall调用次数，大量、频繁的绘制请求，会一定程度上降低游戏帧率，造成游戏卡顿等问题",weight:5},headers:[{key:"drawcall",header:"峰值drawcall"}],threshold:200},[yt.noTextureCompression]:{metaInfo:{name:"使用资源纹理压缩",description:"建议针对纹理资源，使用纹理压缩，减少纹理体积大小，提升用户体验。",weight:1},headers:[],threshold:!0},[yt.incorrectTextureCompressionFormat]:{metaInfo:{name:"使用合理的纹理压缩格式",description:"建议使用当前平台所支持的纹理压缩格式，减少纹理大小，提升用户体验。",document:[{title:"常见纹理压缩格式兼容性",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-technical-manual.html"}],weight:1},headers:[{key:"asset",header:"资源名",width:"80%"},{key:"format",header:"压缩格式"}]},[yt.unreleasedCanvas]:{metaInfo:{name:"及时释放Canvas",description:"建议主动释放Canvas实例，减少内存占用，特别是在iOS设备下，过高的内存占用较为容易造成内存不足而导致小游戏被kill的问题。",weight:0},headers:[{key:"count",header:"未释放canvas数"}]}},[ut.Compatibility]:{[kt.noJsError]:{metaInfo:{name:"避免未处理的JavaScript异常",description:"出现 JavaScript 异常可能导致程序的交互无法进行下去，我们应当追求零异常，保证程序的高鲁棒性和高可用性。",weight:9},headers:[{key:"message",header:"错误信息",width:"80%"},{key:"stack",header:"错误堆栈"}]},[kt.noUnhandledRejection]:{metaInfo:{name:"避免存在未处理的Promise错误",description:"存在未处理的Promise异常，可能导致游戏的交互无法进行下去，可使用 .catch()方法 或 try...catch 语句来处理相关的错误，保证程序的高鲁棒性和高可用性。",weight:9},headers:[{key:"reason",header:"错误信息"}]},[kt.noNetworkError]:{metaInfo:{name:"避免网络请求失败",description:"网络请求失败可能导致程序无法进行下去，应当保证所有请求都能成功。",weight:10},headers:[{key:"url",header:"URL",width:"80%"},{key:"errMsg",header:"错误信息"}]},[kt.noNetworkStatusError]:{metaInfo:{name:"避免网络状态码异常",description:"存在网络状态码异常的请求，处理异常的网络请求，有助于提升用户体验和系统的稳定性。",weight:10},headers:[{key:"url",header:"URL",width:"80%"},{key:"statusCode",header:"状态码"}]}},[ut.WxAPI]:{[wt.deprecatedApis]:{metaInfo:{name:"避免使用废弃接口",description:"使用即将废弃或已废弃接口，可能导致小游戏运行不正常。建议不要使用，避免后续小游戏运行异常。",weight:3},headers:[{key:"apiName",header:"接口名称"}],threshold:!0},[wt.noCacheApiCall]:{metaInfo:{name:"缓存wx api调用结果",description:"建议在调用API时，使用缓存，减少API的重复调用次数，提升用户体验。",weight:5},headers:[{key:"apiName",header:"接口名称",width:"80%"},{key:"times",header:"调用次数"}],threshold:3}}};bt={},Object.keys(St).forEach((e=>{bt={...bt,...St[e]}})),dt.Start,dt.Performance,dt.Render,dt.Practice,dt.Compatibility,dt.WxAPI;class Ct extends i{constructor(...e){super(...e),this.invokeList=[],this.recordApi=e=>{this.invokeList.push(e.invokeInfo)}}init(){E.on(M.Invoked,this.recordApi)}off(){E.off(M.Invoked,this.recordApi)}getResult(){return{invokeList:this.invokeList}}reset(){this.invokeList=[]}}class Rt extends i{constructor(...e){super(...e),this.fmp={},this.recordFMP=()=>{}}init(){this.initFMP()}off(){}initFMP(){this.fmp={[ft.Init]:[],[ft.Resource]:[],[ft.Inject]:[],[ft.Context]:[],[ft.Compile]:[]}}getResult(){var e=this;return t()((function*(){try{var t=yield e.getTranceInfo();$.debug("traceInfos=",t),e.initFMP(),t.data.forEach((t=>{var n=e.parseTraceInfo(t);if(n){var{type:r}=n,i=gt[r];if(i){var s=e.convert2FMPInfo(n);e.fmp[i].push(s)}}}))}catch(e){$.error("handle trace error, ",e)}return e.fmp}))()}getTranceInfo(){return new Promise(((e,t)=>{H.initParams.getTraceInfo({keys:[pt.JSVMInit,pt.ContactCGI,pt.LaunchCGI,pt.DownloadPkg,pt.FirstRender,pt.JsInject,pt.ResourcePrepare,pt.ResourcePrepareToStartUpDone,pt.StartupDone,pt.StartupToJsInject],success:e,fail:t})}))}reset(){this.fmp=null}parseTraceInfo(e){var t=e.match(/^([^,]*),[^,]*,[^,]*,([^,]*),([^,]*),?(.*)/);if(t){var n=Number(t[2]),r=Number(t[3]),i=t[4],s=new Date(Date.now()-864e5).getTime();if(H.isAndroid&&n<s){var o=H.sdk.WXConfig.coldLaunchTime||0;n+=o,r+=o}try{decodeURIComponent(i)!==i&&(i=decodeURIComponent(i.replaceAll("+","%20")))}catch(e){$.error("trace decode error, ",e)}return{type:t[1],startTime:n,endTime:r,externInfo:i}}}convert2FMPInfo(e){var{type:t,startTime:n,endTime:r,externInfo:i}=e,s=gt[t],o={stageName:t,stageType:s,startTime:n,endTime:r,delta:r-n,extra:i};switch(s){case ft.Init:break;case ft.Inject:o=this.parseInjectInfo(o,e);break;case ft.Resource:o=this.parseResourceInfo(o,e)}return o}parseResourceInfo(e,t){var{externInfo:n}=t,r="",i=0;try{var s=JSON.parse(n);r=s.moduleName,i=s.size}catch(e){$.error("trace json.parse error, ",e)}return{...e,resourceName:r,size:i}}parseInjectInfo(e,t){var n,r,{externInfo:i}=t;if(H.isAndroid)try{i=JSON.parse(i)}catch(e){$.error("parse jsinject info error, ",e)}return w(i)&&([n,r]=i.split(",")),"object"==typeof i&&({fileName:n,fileSize:r}=i),{...e,resourceName:n,fileSize:r?Number(r):0}}}class Pt extends i{constructor(...e){super(...e),this.networkList=[],this.recordNetwork=e=>{var{generalNetworkInfo:t}=e;if(t){var{networkInfo:n,invokeInfoMap:r}=t,i=r.get(t);if(i){var{invokeInfo:s}=i;this.networkList.push(Object.assign({},s,n))}}}}init(){E.on(N.LoadSuccess,this.recordNetwork),E.on(N.LoadFail,this.recordNetwork)}off(){E.off(N.LoadSuccess,this.recordNetwork),E.off(N.LoadFail,this.recordNetwork)}getResult(){return{networkList:this.networkList}}reset(){this.networkList=[]}}class xt extends i{constructor(...e){super(...e),this.performanceList=[],this.recordPerformance=e=>{this.performanceList.push(e.performanceInfo)}}init(){E.on(F.Received,this.recordPerformance)}off(){E.off(F.Received,this.recordPerformance)}getResult(){return{performanceList:this.performanceList}}reset(){this.performanceList=[]}}class Lt extends i{constructor(...e){super(...e),this.metaInfo=void 0,this.failedItems=[],this.ruleId=void 0,this.threshold=void 0,this.headers=void 0,this.disable=!1}addFailedItem(e){e&&this.failedItems.push(e)}addFailedItems(e){e.forEach((e=>{this.addFailedItem(e)}))}generateResult(){var e=Object.assign(Object.create(null),{ruleId:this.ruleId,failedItems:this.failedItems,threshold:this.threshold});return this.headers&&(e.headers=this.headers),this.metaInfo&&Object.assign(e,this.metaInfo),e}clear(){this.failedItems=[]}init(){}off(){}}class _t extends Lt{constructor(...e){super(...e),this.ruleId=It.noCdnCache,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||($.warn(`check ${this.ruleId} failed current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.url),this.addFailedItem(this.generateItem(e)))}}init(){E.on(N.LoadSuccess,this.handler)}off(){E.off(N.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e;return!t||t.networkInfo.cache===this.threshold}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class Et extends Lt{constructor(...e){super(...e),this.ruleId=It.noContentEncoding,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||($.warn(`check ${this.ruleId} failed, current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.url),this.addFailedItem(this.generateItem(e)))}}init(){E.on(N.LoadSuccess,this.handler)}off(){E.off(N.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r=t.result,{contentEncoding:i}=t.networkInfo;return B(r.statusCode)&&i&&(n=i.includes("gzip")||i.includes("br")),n===this.threshold}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class Nt extends Lt{constructor(...e){super(...e),this.ruleId=It.noHttp2,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||($.warn(`check ${this.ruleId} failed, current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.url,e.args),this.addFailedItem(this.generateItem(e)))}}init(){E.on(N.LoadSuccess,this.handler)}off(){E.off(N.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r,i,s=t.result,{networkInfo:o}=t;B(s.statusCode)&&o.protocol&&(n="h2"===o.protocol||(null===(r=o.protocol)||void 0===r||null===(i=r.includes)||void 0===i?void 0:i.call(r,"http/2")));return n===this.threshold}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class At extends Lt{constructor(...e){super(...e),this.ruleId=It.highNetworkQueueingLatency,this.threshold=St[ut.Practice][this.ruleId].threshold,this.averageQueueTime=0,this.handler=()=>{this.check()||($.warn(`check ${It.highNetworkQueueingLatency} failed, current=`,this.averageQueueTime,", threshold=",this.threshold),this.addFailedItem(this.generateItem()))}}init(){E.on(A.BeforeResult,this.handler)}off(){E.off(A.BeforeResult,this.handler)}check(){var{totalQueueCount:e,totalQueueTime:t,invokeCount:n}=Q.networkInfo;return 0===n||(e&&(this.averageQueueTime=t/e),this.averageQueueTime<this.threshold)}generateItem(){return{networkQueueingLatency:this.averageQueueTime}}}class Ft extends Lt{constructor(...e){super(...e),this.ruleId=It.highSingleNetworkResponse,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||($.warn(`check ${this.ruleId} failed, current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.byteLength,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){E.on(N.LoadSuccess,this.handler)}off(){E.off(N.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r=t.result,{byteLength:i}=t.networkInfo;return B(r.statusCode)&&i&&(n=i<this.threshold),n}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class Dt extends Lt{constructor(...e){super(...e),this.ruleId=It.largeNetworkResponse,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=()=>{this.check()||($.warn("check large-network-response failed, current=",Q.networkInfo.responseSize,", threshold=",this.threshold),this.addFailedItem(this.generateItem()))}}init(){E.on(A.BeforeResult,this.handler)}off(){E.off(A.BeforeResult,this.handler)}check(){return Q.networkInfo.responseSize<this.threshold}generateItem(){return{byteLength:Q.networkInfo.responseSize}}}class Mt extends Lt{constructor(...e){super(...e),this.ruleId=It.longSingleNetworkLatency,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=e=>{if(!this.check(e)){var{generalNetworkInfo:t}=e,n=null==t?void 0:t.invokeInfoMap.get(t);$.warn(`check ${It.longSingleNetworkLatency} failed, current=`,null==n?void 0:n.invokeInfo.callbackDuration,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e))}}}init(){E.on(N.LoadSuccess,this.handler)}off(){E.off(N.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r=t.result,i=t.invokeInfoMap.get(t);if(i){var{invokeInfo:{callbackDuration:s}}=i;B(r.statusCode)&&s&&(n=s<this.threshold)}return n}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class qt extends Lt{constructor(...e){super(...e),this.ruleId=It.noInteractionReport,this.threshold=St[ut.Practice][this.ruleId].threshold,this.reported=!1,this.handler=()=>{this.check()||($.warn(`check ${this.ruleId} failed, current=`,this.reported),this.addFailedItem(this.generateItem()))},this.reportInteractionHandler=()=>{this.reported=!0}}init(){E.on(A.BeforeResult,this.handler),E.on(M.ReportInteraction,this.reportInteractionHandler)}off(){E.off(A.BeforeResult,this.handler),E.off(M.ReportInteraction,this.reportInteractionHandler)}generateItem(){return{passed:!1}}check(){return this.reported===this.threshold}clear(){super.clear(),this.reported=!1}}class Wt extends Lt{constructor(...e){super(...e),this.ruleId=It.noIosHighPerformance,this.iosHighPerformance=!0,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=()=>{this.check()||($.warn(`check ${this.ruleId} failed, current=`,this.iosHighPerformance),this.addFailedItem(this.generateItem()))}}init(){E.on(A.Start,this.handler)}off(){E.off(A.Start,this.handler)}generateItem(){return{passed:!1}}check(){return this.iosHighPerformance=H.iOSHighPerformance,this.iosHighPerformance===this.threshold}}class Gt extends Lt{constructor(...e){super(...e),this.ruleId=It.noParallelDownload,this.parallelDownload=!0,this.threshold=St[ut.Practice][this.ruleId].threshold,this.handler=()=>{this.check()||($.warn(`check ${this.ruleId} failed, current=`,this.parallelDownload),this.addFailedItem(this.generateItem()))}}init(){E.on(A.Start,this.handler)}off(){E.off(A.Start,this.handler)}generateItem(){return{passed:!1}}check(){var e,t;return(null===(e=H.subpackages)||void 0===e?void 0:e.length)&&(null===(t=H.parallelPreloadSubpackages)||void 0===t?void 0:t.length)}}class Ot extends Lt{constructor(...e){super(...e),this.ruleId=It.highNetworkQueueingCount,this.threshold=St[ut.Practice][this.ruleId].threshold,this.totalQueueCount=0,this.handler=()=>{this.check()&&($.warn(`check ${this.ruleId} failed, current=`,this.totalQueueCount,", threshold=",this.threshold),this.addFailedItem(this.generateItem()))}}init(){E.on(A.BeforeResult,this.handler)}off(){E.off(A.BeforeResult,this.handler)}check(){var{totalQueueCount:e}=Q.networkInfo;return this.totalQueueCount=e,e&&e>this.threshold}clear(){super.clear(),this.totalQueueCount=0}generateItem(){return{totalQueueCount:this.totalQueueCount}}}class jt extends Lt{constructor(...e){super(...e),this.ruleId=It.lowNetworkLatencyRation,this.threshold=St[ut.Practice][this.ruleId].threshold,this.networkLatencyRation=0,this.handler=()=>{this.check()||($.warn(`check ${It.lowNetworkLatencyRation} failed, current=`,100*this.networkLatencyRation,", threshold=",this.threshold),this.addFailedItem(this.generateItem()))}}init(){E.on(A.BeforeResult,this.handler)}off(){E.off(A.BeforeResult,this.handler)}check(){var{totalNetworkTime:e}=Q.networkInfo;return 0===e||(this.networkLatencyRation=e/S.getRuntime(),this.networkLatencyRation>this.threshold/100)}generateItem(){return{networkLatencyRation:this.networkLatencyRation}}}class Bt extends Lt{constructor(...e){super(...e),this.ruleId=mt.longInteractionCost,this.threshold=St[ut.Launch][this.ruleId].threshold,this.handler=e=>{this.check(e)||($.warn(`check ${this.ruleId} failed, current=`,e.costTime,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){E.on(M.ReportInteraction,this.handler)}off(){E.off(M.ReportInteraction,this.handler)}check(e){var{costTime:t,sceneId:n}=e;return!n||7!==n||!t||t<this.threshold}generateItem(e){return e}}class Vt extends Lt{constructor(...e){super(...e),this.ruleId=vt.highAverageFps,this.threshold=St[ut.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||this.addFailedItem(this.generateItem(e))}}init(){E.on(F.Received,this.handler)}off(){E.off(F.Received,this.handler)}check(e){var{performanceInfo:t}=e;return t.fps>this.threshold}generateItem(e){return{fps:e.performanceInfo.fps,uniqueId:e.performanceInfo.uniqueId}}}class Ut extends Lt{constructor(...e){super(...e),this.ruleId=vt.highCpuUsage,this.threshold=St[ut.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||this.addFailedItem(this.generateItem(e))}}init(){E.on(F.Received,this.handler)}off(){E.off(F.Received,this.handler)}check(e){var{performanceInfo:t}=e;return t.cpu<this.threshold}generateItem(e){return{cpu:e.performanceInfo.cpu,uniqueId:e.performanceInfo.uniqueId}}}class Kt extends Lt{constructor(...e){super(...e),this.ruleId=vt.highMemoryUsage,this.threshold=St[ut.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||this.addFailedItem(this.generateItem(e))}}init(){E.on(F.Received,this.handler)}off(){E.off(F.Received,this.handler)}check(e){var{performanceInfo:t}=e;return t.memory<this.threshold}generateItem(e){return{memory:e.performanceInfo.memory,uniqueId:e.performanceInfo.uniqueId}}}class $t extends Lt{constructor(...e){super(...e),this.ruleId=vt.highStutter,this.threshold=St[ut.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||this.addFailedItem(this.generateItem(e))}}init(){E.on(F.Received,this.handler)}off(){E.off(F.Received,this.handler)}check(e){var{performanceInfo:t}=e;return t.stutter<this.threshold}generateItem(e){return{stutter:e.performanceInfo.stutter,uniqueId:e.performanceInfo.uniqueId}}}class Ht extends Lt{constructor(...e){super(...e),this.ruleId=yt.highDrawcall,this.drawcall=0,this.latestFrame=0,this.threshold=St[ut.Render][this.ruleId].threshold,this.handler=()=>{this.drawcall+=1,this.latestFrame||(this.latestFrame=S.currentFrame),S.currentFrame!==this.latestFrame&&(this.check()||this.addFailedItem(this.generateItem()),this.latestFrame=0,this.drawcall=0)}}init(){E.on(D.Drawcall,this.handler)}off(){E.off(D.Drawcall,this.handler)}check(){return this.drawcall<this.threshold}generateItem(){return{drawcall:this.drawcall}}}class Jt extends Lt{constructor(...e){super(...e),this.ruleId=yt.noTextureCompression,this.threshold=St[ut.Render][this.ruleId].threshold,this.count=0,this.recordTextureCompression=()=>{this.count+=1},this.handler=()=>{this.check()||this.addFailedItem(this.generateItem())}}init(){E.on(A.End,this.handler),E.on(D.NoTextureCompressionFormat,this.recordTextureCompression)}off(){E.off(D.NoTextureCompressionFormat,this.recordTextureCompression),E.off(A.End,this.handler)}clear(){super.clear(),this.count=0}check(){return this.count>this.threshold}generateItem(){return{count:this.count}}}class zt extends Lt{constructor(...e){super(...e),this.ruleId=yt.incorrectTextureCompressionFormat,this.threshold=St[ut.Render][this.ruleId].threshold,this.count=0,this.recordTextureCompression=()=>{this.count+=1},this.handler=()=>{this.check()||this.addFailedItem(this.generateItem())}}init(){E.on(A.End,this.handler),E.on(D.TextureCompressionFormat,this.recordTextureCompression)}off(){E.off(D.TextureCompressionFormat,this.recordTextureCompression),E.off(A.End,this.handler)}clear(){super.clear(),this.count=0}check(){return this.count<=this.threshold}generateItem(){return{count:this.count}}}class Qt extends Lt{constructor(...e){super(...e),this.ruleId=kt.noJsError,this.threshold=St[ut.Compatibility][this.ruleId].threshold,this.handler=e=>{$.warn(`check ${this.ruleId} failed, current=`,e.message),this.addFailedItem(this.generateItem(e))}}init(){E.on(M.JsError,this.handler)}off(){E.off(M.JsError,this.handler)}generateItem(e){return{message:String.prototype.slice.call(e.message,0,1024),stack:String.prototype.slice.call(e.stack,0,1024),frame:S.currentFrame,runtime:S.getRuntime()}}}class Xt extends Lt{constructor(...e){super(...e),this.ruleId=kt.noUnhandledRejection,this.threshold=St[ut.Compatibility][this.ruleId].threshold,this.handler=e=>{$.warn(`check ${this.ruleId} failed, current=`,e.reason),this.addFailedItem(this.generateItem(e))}}init(){E.on(M.UnhandledPromiseRejection,this.handler)}off(){E.off(M.UnhandledPromiseRejection,this.handler)}generateItem(e){return{reason:String.prototype.slice.call(e.reason,0,1024),frame:S.currentFrame,runtime:S.getRuntime()}}}class Yt extends Lt{constructor(...e){super(...e),this.ruleId=kt.noNetworkError,this.threshold=St[ut.Compatibility][this.ruleId].threshold,this.handler=e=>{$.warn(`check ${this.ruleId} failed, info=`,e),this.addFailedItem(this.generateItem(e))}}init(){E.on(N.LoadFail,this.handler)}off(){E.off(N.LoadFail,this.handler)}generateItem(e){var{generalNetworkInfo:t}=e;if(t){var n,r=null===(n=t.invokeInfoMap.get(t))||void 0===n?void 0:n.invokeInfo;return{uniqueId:null==r?void 0:r.uniqueId}}return null}}class Zt extends Lt{constructor(...e){super(...e),this.ruleId=kt.noNetworkStatusError,this.threshold=St[ut.Compatibility][this.ruleId].threshold,this.handler=e=>{this.check(e)||($.warn(`check ${this.ruleId} failed, info=`,e),this.addFailedItem(this.generateItem(e)))}}init(){E.on(N.LoadSuccess,this.handler)}off(){E.off(N.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;return t?(B(t.result.statusCode)||(n=!1),n):n}generateItem(e){var{generalNetworkInfo:t}=e;if(t){var n,r=null===(n=t.invokeInfoMap.get(t))||void 0===n?void 0:n.invokeInfo;return{uniqueId:null==r?void 0:r.uniqueId}}return null}}class en extends Lt{constructor(...e){super(...e),this.ruleId=wt.deprecatedApis,this.threshold=St[ut.WxAPI][this.ruleId].threshold,this.handler=e=>{this.check(e)||($.warn(`check ${this.ruleId} failed, apiName=`,e.invokeInfo.apiName),this.addFailedItem(this.generateItem(e)))}}init(){E.on(M.Invoked,this.handler)}off(){E.off(M.Invoked,this.handler)}check(e){return!e||V.includes(e.invokeInfo.apiName)!==this.threshold}generateItem(e){return{uniqueId:e.invokeInfo.uniqueId}}}const tn=["getSystemInfo","getSystemInfoSync"];class nn extends Lt{constructor(...e){super(...e),this.ruleId=wt.noCacheApiCall,this.threshold=St[ut.WxAPI][this.ruleId].threshold,this.apiInvokeInfo={},this.handler=()=>{Object.keys(this.apiInvokeInfo).forEach((e=>{this.check(e)||this.addFailedItem({apiName:e,times:this.apiInvokeInfo[e].times,uniqueIds:this.apiInvokeInfo[e].uniqueIds})}))},this.recordApi=e=>{var{apiName:t}=e.invokeInfo;tn.includes(e.invokeInfo.apiName)&&(this.apiInvokeInfo[t]=this.apiInvokeInfo[t]||{times:0,uniqueIds:[]},this.apiInvokeInfo[t].times+=1,this.apiInvokeInfo[t].uniqueIds.push(e.invokeInfo.uniqueId))}}init(){E.on(A.BeforeResult,this.handler),E.on(M.Invoked,this.recordApi)}off(){E.off(A.BeforeResult,this.handler),E.off(M.Invoked,this.recordApi)}check(e){return!this.apiInvokeInfo[e]||this.apiInvokeInfo[e].times<this.threshold}clear(){super.clear(),this.apiInvokeInfo={}}}var rn=new class{get writingCount(){return 0}constructor(){this.fileInfo=void 0,this.reset()}reset(){this.fileInfo={}}invokeStart(e){if(bn.isRunning){var t,n;if(e.invokeInfo.apiName.includes("read"))this.fileInfo.readingCount=(null!==(t=this.fileInfo.readingCount)&&void 0!==t?t:0)+1;if(e.invokeInfo.apiName.includes("write"))this.fileInfo.writingCount=(null!==(n=this.fileInfo.wirtingCount)&&void 0!==n?n:0)+1}}afterExecute(e){bn.isRunning&&e.isSyncApi&&(this.updateCount(e),this.updateSize(e))}invokeSuccess(e){bn.isRunning&&(e.isSyncApi||(this.updateCount(e),this.updateSize(e)))}invokeFail(e){bn.isRunning&&this.updateCount(e)}updateCount(e){var t,n,r,i,{invokeInfo:s}=e;s.apiName.includes("read")&&(this.fileInfo.readingCount=(null!==(t=this.fileInfo.readingCount)&&void 0!==t?t:0)-1,this.fileInfo.readCount=(null!==(n=this.fileInfo.readCount)&&void 0!==n?n:0)+1);s.apiName.includes("write")&&(this.fileInfo.writingCount=(null!==(r=this.fileInfo.writingCount)&&void 0!==r?r:0)-1,this.fileInfo.writeCount=(null!==(i=this.fileInfo.writeCount)&&void 0!==i?i:0)+1)}updateSize(e){var t,n,r,i,{invokeInfo:s,result:o}=e,a=null==o?void 0:o.data;s.apiName.includes("read")&&(this.fileInfo.readCost=(null!==(t=this.fileInfo.readCost)&&void 0!==t?t:0)+s.callbackDuration,this.fileInfo.readSize=(null!==(n=this.fileInfo.readSize)&&void 0!==n?n:0)+((null==a?void 0:a.byteLength)||(null==a?void 0:a.length)));s.apiName.includes("write")&&(this.fileInfo.writeCost=(null!==(r=this.fileInfo.writeCost)&&void 0!==r?r:0)+s.callbackDuration,this.fileInfo.writeSize=(null!==(i=this.fileInfo.writeSize)&&void 0!==i?i:0)+((null==a?void 0:a.byteLength)||(null==a?void 0:a.length)))}isWriteApi(){}isReadApi(){}};const sn=class extends i{constructor(...e){super(...e),this.inited=!1,this.checkTypes=new Map}register(e){null!=e&&e.length?e.forEach((e=>{e&&(this.checkTypes.has(e.type)&&$.warn(`覆盖已存在的同名CustomCheckType:${e.type}`),this.checkTypes.set(e.type,e),this.inited&&e.initialize())})):$.warn("[register]请传入参数")}initialize(){Array.from(this.checkTypes.values()).forEach((e=>{e.initialize()})),this.inited=!0}off(){Array.from(this.checkTypes.values()).forEach((e=>{e.off()})),this.inited=!1}reset(){Array.from(this.checkTypes.values()).forEach((e=>{e.reset()}))}getResult(){var e=[];return Array.from(this.checkTypes.values()).forEach((t=>{e.push(t.getResult())})),e}}.getInstance();class on extends i{constructor(...e){super(...e),this.deviceInfo=void 0,this.result=void 0,this.resultFilename="__detect_result.txt"}reset(){this.result=null}getDeviceInfo(){var e=this;return t()((function*(){var t=g(),n=m();if(!e.deviceInfo&&t&&n){var r=yield e.getNetworkType();e.deviceInfo={platform:ct[t.platform],wechatVersion:n.version,deviceBrand:t.brand,deviceModel:e.convertDeviceModel(t.model),SDKVersion:n.SDKVersion,osName:t.system,osVersion:t.system,memorySize:t.memorySize,benchmarkLevel:t.benchmarkLevel,networkType:r}}return e.deviceInfo}))()}uploadReport(){var e=this;return t()((function*(){var t=yield e.getResult();return e.addEveluationReport(t)}))()}getNetworkType(){return new Promise(((e,t)=>{p().getNetworkType({success(t){e(t.networkType)},fail:t})}))}addEveluationReport(e){var n=this;return t()((function*(){var t,r,[,i]=yield y(n.storeResult(e));if(i){ye.start(ve.UploadReport);var[s,o]=yield y(n.uploadEveluationReport(i));if(s)return ye.timeEnd(ve.UploadReport),function({errMsg:e}){H.isWxApplib&&Ve.report({Type:fe.Error,Target:ve.UploadReport,ExternInfo:{errMsg:String(e).slice(0,1024),...Ue()}})}((null==s?void 0:s.errMsg)||(null==s?void 0:s.statusCode)||s),$.error("upload error, ",s),an.getInstance().showUploadFailed(s,!0),Promise.reject(s);if(o){var a,l,h,c,u;$.event("upload success, ",o),function({costTime:e,blobid:t}){H.isWxApplib&&Ve.report({Type:fe.Info,Target:ve.UploadReport,ExternInfo:{costTime:e,blobid:t,...Ue()}})}({blobid:o,costTime:ye.timeEnd(ve.UploadReport)}),ye.start(ve.AddEveluationReport);var d=H.sdk.WXConfig,[f,p]=yield y(ot({device:n.convertDeviceInfo(e.device),start_time:H.meta.startTime,blob_id:o,end_time:H.meta.endTime,official_desc:(null==H||null===(a=H.audits)||void 0===a?void 0:a.systemDescription)||"",is_auto_start:H.meta.isAutoStart,launch_time:H.meta.launchTime,sdk_version:H.meta.sdkVersion,app_launch_info:{code_launch_time:d.coldLaunchTime,preload:d.preload,env_preload_type:d.envPreloadType,preload_type:d.preloadType,download_code:null===(l=d.appLaunchInfo)||void 0===l?void 0:l.downloadCode,plugin_info:null===(h=d.appContactInfo)||void 0===h||null===(c=h.call_plugin_info)||void 0===c||null===(u=c.map)||void 0===u?void 0:u.call(c,(e=>({plugin_id:e.plugin_id,plugin_version:e.plugin_version})))}}));return p&&0===p.errcode?(r=ye.timeEnd(ve.AddEveluationReport),H.isWxApplib&&Ve.report({Type:fe.Info,Target:ve.AddEveluationReport,ExternInfo:{costTime:r,...Ue()}}),$.debug("addGameEveluationReport success, ",p),$.event("addGameEveluationReport success"),an.getInstance().showUploadSuccess(),n.removeResult(),Promise.resolve()):(t=(null==f?void 0:f.errMsg)||(null==p?void 0:p.errcode),H.isWxApplib&&Ve.report({Type:fe.Error,Target:ve.AddEveluationReport,ExternInfo:{errMsg:String(t).slice(0,1024),...Ue()}}),$.error("addEveluation error, ",f||p),an.getInstance().showUploadFailed(f||p),Promise.reject(f||p))}}}))()}uploadEveluationReport(e){return at(e).then((e=>e.data&&e.data.file_meta_list?Promise.resolve(e.data.file_meta_list[0].blob_id):Promise.reject(e.errcode)))}storeResult(e){return new Promise(((t,n)=>{var{wxapi:r,network:i,performance:o,checkLists:a,fmp:l,customCheckLists:h}=e,c=0;try{ye.start("stringifyResult"),c=JSON.stringify(e).length,$.debug("report fileSize=",c,", cost=",ye.timeEnd("stringifyResult"))}catch(e){$.error("calculate report fileSize error, ",e)}var u=`${p().env.USER_DATA_PATH}/${this.resultFilename}`;ye.start(ve.WriteReport),s({filePath:u,data:JSON.stringify({wxapi:r,network:i,performance:o,checkLists:a,customCheckLists:h,fmp:l}),success:()=>{!function({fileSize:e,costTime:t}){H.isWxApplib&&Ve.report({Type:fe.Info,Target:ve.WriteReport,ExternInfo:{fileSize:e,costTime:t,...Ue()}})}({fileSize:c,costTime:ye.timeEnd(ve.WriteReport)}),t(u)},fail:e=>{!function({fileSize:e,errMsg:t}){H.isWxApplib&&Ve.report({Type:fe.Error,Target:ve.WriteReport,ExternInfo:{fileSize:e,errMsg:String(t).slice(0,1024),...Ue()}})}({fileSize:c,errMsg:e.errMsg}),n(e)}})}))}removeResult(){return new Promise(((e,t)=>{var n=`${p().env.USER_DATA_PATH}/${this.resultFilename}`;ye.start(ve.RemoveReportFile),o({filePath:n,success:t=>{var n;n=ye.timeEnd(ve.RemoveReportFile),H.isWxApplib&&Ve.report({Type:fe.Info,Target:ve.RemoveReportFile,ExternInfo:{costTime:n,...Ue()}}),e(t)},fail:e=>{var n;n=e.errMsg,H.isWxApplib&&Ve.report({Type:fe.Error,Target:ve.RemoveReportFile,ExternInfo:{errMsg:String(n).slice(0,1024),...Ue()}}),t(e)}})}))}getResult(){var e=this;return t()((function*(){if(!e.result){var t=Ct.getInstance().getResult(),n=Pt.getInstance().getResult(),r=xt.getInstance().getResult(),i=yield Rt.getInstance().getResult(),s=function(){var e=Tt[dt.Practice];return e.subItems=[_t.getInstance().generateResult(),Et.getInstance().generateResult(),Nt.getInstance().generateResult(),At.getInstance().generateResult(),Ft.getInstance().generateResult(),Dt.getInstance().generateResult(),Mt.getInstance().generateResult(),qt.getInstance().generateResult(),Wt.getInstance().generateResult(),Gt.getInstance().generateResult(),Ot.getInstance().generateResult(),jt.getInstance().generateResult()],e}(),o=function(){var e=Tt[dt.Start];return e.subItems=[Bt.getInstance().generateResult()],e}(),a=function(){var e=Tt[dt.Performance];return e.subItems=[Vt.getInstance().generateResult(),Ut.getInstance().generateResult(),Kt.getInstance().generateResult(),$t.getInstance().generateResult()],e}(),l=function(){var e=Tt[dt.Render];return e.subItems=[Jt.getInstance().generateResult()],e}(),h=function(){var e=Tt[dt.Compatibility];return e.subItems=[Qt.getInstance().generateResult(),Xt.getInstance().generateResult(),Yt.getInstance().generateResult(),Zt.getInstance().generateResult()],e}(),c=function(){var e=Tt[dt.WxAPI];return e.subItems=[en.getInstance().generateResult(),nn.getInstance().generateResult()],e}(),u=sn.getResult();H.meta.uploadTime=Date.now(),e.result={meta:H.meta,device:e.deviceInfo,wxapi:t,network:n,performance:r,checkLists:[s,o,a,l,h,c],customCheckLists:[...u],fmp:i}}return $.debug("result=",e.result),$.debug("fileInfo=",rn.fileInfo),e.result}))()}convertDeviceInfo(e){if(!e)return{};var{platform:t,wechatVersion:n,deviceBrand:r,deviceModel:i,SDKVersion:s,osName:o,osVersion:a,benchmarkLevel:l,memorySize:h,networkType:c}=e;return{platform:t,wechat_version:n,device_brand:r,device_model:i,sdk_version:s,os_name:o,os_version:a,benchmark_level:l,memory_size:h,network_type:c}}convertDeviceModel(e){if(null!=e&&e.includes("unknown")&&"ios"===H.sdk.WXConfig.platform){if(e.includes("<iPhone15,4>"))return"iPhone 15";if(e.includes("<iPhone15,5>"))return"iPhone 15 Plus";if(e.includes("<iPhone16,1>"))return"iPhone 15 Pro";if(e.includes("<iPhone16,2>"))return"iPhone 15 Pro Max"}return e}}class an extends i{constructor(...e){super(...e),this.coverview=void 0,this.ui=void 0,this.inited=!1,this.draged=!1,this.screenWidth=0,this.screenHeight=0,this.defaultWidth=76,this.defaultHeight=ge,this.defaultTop=60,this.defaultTopPortrait=200,this.defaultLeft=0,this.deviceOrientation="portrait",this.initReadyPromise=void 0,this.resolveFunc=void 0,this.triggerBtnStatus=e=>{if(this.coverview){var{getPrivateThis:t}=this.coverview,n=t(this.ui);e?(n.operateBtn.value="录制中...",n.operateBtn.style.color="#ff6146",n.startIcon.style.hidden=!0,n.stopIcon.style.hidden=!1):(n.operateBtn.value="开始录制",n.operateBtn.style.color="#ffffff",n.stopIcon.style.hidden=!0,n.startIcon.style.hidden=!1)}},this.triggerUIVisible=e=>{if(this.coverview){var{getPrivateThis:t}=this.coverview;t(this.ui).body.style.hidden=!e}}}init(e){!this.inited&&H.showUI&&(this.inited=!0,e&&(this.coverview=e,this.initReadyPromise=new Promise((e=>this.resolveFunc=e)),setTimeout((()=>{this.create()}),1e3)))}create(){if(this.coverview){var{Component:e,getPrivateThis:t,init:n,webviewLayout:r,xmlParser:i}=this.coverview;this.ui=new e;var s=t(this.ui),o=i('\n  <view id="body">\n    <view id="container">\n      <image id="stop-icon" src="https://mmgame.qpic.cn/image/b5afaa12383dfdd20314efea098fc902f29b33df99010626b01f676f3765d82c/0"></image>\n      <image id="start-icon" src="https://mmgame.qpic.cn/image/171782a3ed34a9322ef8ceed3916b13a293475191ca0745dbb6a3988bc634bf8/0"></image>\n      <text id="operate-btn" value="开始录制"></text>\n    </view>\n    <view id="touch-mask"></view>\n  </view>\n').root,a=JSON.parse(JSON.stringify(me)),l=O(o,"operate-btn"),h=c();this.setDeviceOrientation(h),Tn.autoStart?(l.attributes.value="录制中...",a.operateBtn.color="#ff6146",a.startIcon.hidden=!0,a.stopIcon.hidden=!1):(l.attributes.value="开始录制",a.operateBtn.color="#ffffff",a.stopIcon.hidden=!0,a.startIcon.hidden=!1),this.setOperateBtnPos(a,h),n.call(this.ui,o,a),r.add(s.body),H.enableByClient||this.bindDragEvent(s),s.body.ready().then((()=>{this.resolveFunc()}))}}setOperateBtnPos(e,t){var{deviceOrientation:n}=this,r="landscape"===n||"landscapeLeft"===n?t.safeArea.left||t.safeArea.top:0;"portrait"!==n&&"landscapeRight"!==n||(e.body.top=this.defaultTopPortrait,e.body.left=this.defaultLeft),"landscape"!==n&&"landscapeLeft"!==n||(e.body.top=this.defaultTop,e.body.left=this.defaultLeft+r)}setDeviceOrientation(e){var t=e.deviceOrientation,n=e.windowWidth,r=e.windowHeight;return"portrait"===t&&n>r?n>r&&(t="landscape",n=e.windowHeight,r=e.windowWidth):n<r&&(t="portrait",n=e.windowHeight,r=e.windowWidth),this.deviceOrientation=t,this.screenWidth=n,this.screenHeight=r,this.deviceOrientation}bindDragEvent(e){e.touchMask.on("touchstart",(t=>{this.beforeDrag(e);var n=t.x-e.container.style.left,r=t.y-e.container.style.top,i=t=>{this.draged=!0;var i=t[0].x-n,s=t[0].y-r,o=this.screenWidth-this.defaultWidth,a=this.screenHeight-this.defaultHeight;e.container.style.left=Math.max(0,Math.min(i,o)),e.container.style.top=Math.max(0,Math.min(s,a))},s=()=>{e.touchMask.off("touchmove",i),e.touchMask.off("touchend",s),this.draged||(Tn.isRunning?this.showConfirm():this.setRunning()),this.draged=!1,this.afterDrag(e)};e.touchMask.on("touchmove",i),e.touchMask.on("touchend",s)}))}bindClick(e){ce(e.touchMask,(()=>{Tn.isRunning?this.showConfirm():this.setRunning()}))}beforeDrag(e){e.container.style.opacity=0,e.body.style.width=this.screenWidth,e.body.style.height=this.screenHeight,e.container.style.left=e.body.style.left,e.container.style.top=e.body.style.top,e.touchMask.style.left=e.body.style.left,e.touchMask.style.top=e.body.style.top,e.body.style.top=0,e.body.style.left=0,e.container.style.opacity=1}afterDrag(e){e.container.style.hidden=!0,e.body.style.left=e.container.style.left,e.body.style.top=e.container.style.top,e.body.style.height=this.defaultHeight,e.body.style.width=this.defaultWidth,e.container.style.left=0,e.container.style.top=0,e.touchMask.style.left=0,e.touchMask.style.top=0,e.container.style.hidden=!1}setRunning(){Tn.start(),this.initReadyPromise.then((()=>{this.triggerBtnStatus(!0)}))}setStop(e=!0){this.initReadyPromise.then((()=>{this.triggerBtnStatus(!1)})),e&&this.showLoading("上传中..."),Tn.stop(e)}hideLoading(){h()}showLoading(e=""){l({title:e})}showConfirm(){v()({title:"是否结束录制并上传本次评测数据？",content:"将会根据上传数据分析得出录制期间的性能报告",confirmText:"上传数据",success:e=>{e.confirm?this.setStop():H.enableByClient&&this.setStop(!1)}})}showUploadSuccess(){if(H.showUI){var e=v();this.hideLoading(),e({title:"数据上传成功",content:"请前往【MP-研发工具箱-性能诊断工具】查看报告",showCancel:!1,confirmText:"我知道了"})}}showUploadFailed(e,t=!1){if(H.showUI){var n=v();this.hideLoading();var r=e;if(!("number"==typeof e)){var{statusCode:i}=e,{errcode:s}=e;r=i||s||e.errno}n({title:t?"报告上传失败":"报告添加失败",content:`错误代码: ${r=Xe[r]||r}`,confirmText:"重试",success(e){e.confirm&&on.getInstance().uploadReport().then(Tn.reset)}})}}hide(){if(this.coverview){var{getPrivateThis:e}=this.coverview;e(this.ui).body.style.hidden=!0}}}function ln(){var e=p(),t=Object.keys(e),n=[X.Request,X.DownloadFile,X.CreateImage,X.CreateCanvas,X.GetFileSystemManager,X.GetGameAudits],r=[...[Y.Env,Y.Cloud],...n];t.forEach((t=>{if(!r.includes(t)){var n=e[t];"function"==typeof n&&Reflect.defineProperty(e,t,{value:(...e)=>ne(t,n,void 0,...e)})}})),function(){var e=p();Reflect.defineProperty(e,"startMinigameDetect",{value(){an.getInstance().setRunning()},configurable:!0}),Reflect.defineProperty(e,"stopMinigameDetect",{value(){an.getInstance().setStop()},configurable:!0})}()}var hn=null;class cn{constructor(e){var t;this.type=void 0,this.name=void 0,this.description=void 0,this.taskMap=new Map,this.inited=!1,this.type=e.type,this.name=e.name,this.description=e.description,null!==(t=e.tasks)&&void 0!==t&&t.length&&this.register(e.tasks)}initialize(){Array.from(this.taskMap.values()).forEach((e=>{e.init()})),this.inited=!0}register(e){e.forEach((e=>{this.taskMap.has(e.ruleId)&&$.warn(`覆盖已经存在的同名Task:${e.ruleId}`),this.taskMap.set(e.ruleId,e),this.inited&&e.init()}))}off(e){null!=e&&e.length?e.forEach((e=>{e.off()})):Array.from(this.taskMap.values()).forEach((e=>{e.off()}))}reset(){Array.from(this.taskMap.values()).forEach((e=>{e.clear()})),this.inited=!1}getResult(){return{type:this.type,name:this.name,description:this.description,subItems:Array.from(this.taskMap.values()).map((e=>e.generateResult()))}}}var un=null;function dn(){var e=p();Reflect.defineProperty(e,X.GetGameAudits,{value:()=>(un||(un=un={BaseTask:Lt,EventType:{ApiInvokeMessageType:M,DetectEventMessageType:A,NetworkMessageType:N,PerformanceMessageType:F,RenderTypeMessageType:D},CustomCheckType:cn,messenger:{on:E.on.bind(E),once:E.once.bind(E),off:E.off.bind(E)},register:sn.register.bind(sn)}),un)})}var fn=!1;function pn(){var e,t,n,r,i,s;if(!fn){fn=!0,p().onError((e=>{E.emit(M.JsError,{message:e.message,stack:e.stack})})),p().onUnhandledRejection((e=>{E.emit(M.UnhandledPromiseRejection,{reason:e.reason})}));var o=null===(e=H.audits)||void 0===e||null===(t=e.rules)||void 0===t?void 0:t.disableRequest,a=null===(n=H.audits)||void 0===n||null===(r=n.rules)||void 0===r?void 0:r.disableCreateImage,l=null===(i=H.audits)||void 0===i||null===(s=i.rules)||void 0===s?void 0:s.disableDownloadFile;!b(o)&&o||function(){var e=X.Request,t=p(),n=t.request;Object.defineProperties(t,{[e]:{value:t=>ne(e,n,{beforeExecute:n=>{Q.loadStart(n);var r=new Z({generalInvokeInfo:n,apiName:e,args:t,type:X.Request});re.set(n,r),$.debug(t.url,` before ${e} execute, invokeInfo=`,n,", networkInfo=",r.networkInfo),E.emit(N.LoadStart,{args:t,generalNetworkInfo:r})},success:e=>{$.debug(t.url," request success, result=",e.result);var n=re.get(e);n&&(n.complete(),Q.loadSuccess(n)),E.emit(N.LoadSuccess,{args:t,generalNetworkInfo:n})},complete:e=>{$.debug(t.url," request complete");var n=re.get(e);E.emit(N.LoadComplete,{args:t,generalNetworkInfo:n})},fail:e=>{$.error(t.url," request fail, result=",e.result,", msg=",e.invokeInfo.errMsg);var n=re.get(e);n&&(n.complete(),Q.loadFail(n)),E.emit(N.LoadFail,{args:t,generalNetworkInfo:n})}},t),configurable:!0}})}(),!b(a)&&a||function(){var e=p(),t=X.CreateImage,n=e.createImage;Reflect.defineProperty(e,t,{value:()=>ne(t,n,{}),configurable:!0})}(),!b(l)&&l||function(){var e=p(),t=X.DownloadFile,n=e.downloadFile;Object.defineProperties(e,{[t]:{value:e=>ne(t,n,{beforeExecute:n=>{Q.loadStart(n);var r=new Z({generalInvokeInfo:n,apiName:t,args:e,type:X.DownloadFile});ie.set(n,r),$.debug(e.url," before download execute, invokeInfo=",n,", networkInfo=",r.networkInfo),E.emit(N.LoadStart,{args:e,generalNetworkInfo:r})},success:t=>{$.debug(e.url," downloadFile success, result=",t.result);var n=ie.get(t);n&&(n.complete(),Q.loadSuccess(n)),E.emit(N.LoadSuccess,{args:e,generalNetworkInfo:n})},complete:t=>{$.debug(e.url," download complete");var n=ie.get(t);E.emit(N.LoadComplete,{args:e,generalNetworkInfo:n})},fail:t=>{$.error(e.url," download fail, result=",t.result,", msg=",t.invokeInfo.errMsg);var n=ie.get(t);n&&(n.complete(),Q.loadFail(n)),E.emit(N.LoadFail,{args:e,generalNetworkInfo:n})},afterExecute:e=>{var{ret:t}=e;t.onHeadersReceived((function n(r){var i=ie.get(e);null==i||i.checkHeader(r),t.offHeadersReceived(n)}))}},e),configurable:!0}})}(),he(),ln(),function(){var e=p(),t=X.ReportScene,n=e.reportScene;n&&Reflect.defineProperty(e,t,{value:e=>(7===e.sceneId&&E.emit(M.ReportInteraction,{costTime:e.costTime,sceneId:e.sceneId}),ne(t,n,void 0,e)),configurable:!0})}(),function(){var e=p(),t=X.GetFileSystemManager,n=e.getFileSystemManager;Reflect.defineProperty(e,t,{value:()=>ne(t,n,{afterExecute:e=>{if(hn)return hn;var{ret:t}=e;Object.keys(t).forEach((e=>{var n=t[e];Reflect.defineProperty(t,e,{value:(...t)=>ne(`FileSystemManager.${e}`,n,{beforeExecute(e){rn.invokeStart(e)},afterExecute(e){rn.afterExecute(e),E.emit(M.FsApiInvoked,e)},afterSuccess(e){rn.invokeSuccess(e)},afterFail(e){rn.invokeFail(e)}},...t),configurable:!0})})),hn=t}}),configurable:!0})}(),dn()}}function gn(){_t.getInstance().init(),Et.getInstance().init(),Nt.getInstance().init(),At.getInstance().init(),Ft.getInstance().init(),Dt.getInstance().init(),Mt.getInstance().init(),qt.getInstance().init(),Wt.getInstance().init(),Gt.getInstance().init(),Ot.getInstance().init(),jt.getInstance().init(),Ht.getInstance().init(),Jt.getInstance().init(),zt.getInstance().init(),Bt.getInstance().init(),Vt.getInstance().init(),Ut.getInstance().init(),Kt.getInstance().init(),$t.getInstance().init(),Qt.getInstance().init(),Xt.getInstance().init(),Yt.getInstance().init(),Zt.getInstance().init(),en.getInstance().init(),nn.getInstance().init(),sn.initialize()}function mn(){_t.getInstance().off(),Et.getInstance().off(),Nt.getInstance().off(),At.getInstance().off(),Ft.getInstance().off(),Dt.getInstance().off(),Mt.getInstance().off(),qt.getInstance().off(),Wt.getInstance().off(),Gt.getInstance().off(),Ot.getInstance().off(),jt.getInstance().off(),Ht.getInstance().off(),Jt.getInstance().off(),zt.getInstance().off(),Bt.getInstance().off(),Vt.getInstance().off(),Ut.getInstance().off(),Kt.getInstance().off(),$t.getInstance().off(),Qt.getInstance().off(),Xt.getInstance().off(),Yt.getInstance().off(),Zt.getInstance().off(),en.getInstance().off(),nn.getInstance().off(),sn.off()}function vn(){_t.getInstance().clear(),Et.getInstance().clear(),Nt.getInstance().clear(),At.getInstance().clear(),Ft.getInstance().clear(),Dt.getInstance().clear(),Mt.getInstance().clear(),qt.getInstance().clear(),Wt.getInstance().clear(),Gt.getInstance().clear(),Ot.getInstance().clear(),jt.getInstance().clear(),Ht.getInstance().clear(),Jt.getInstance().clear(),zt.getInstance().clear(),Bt.getInstance().clear(),Vt.getInstance().clear(),Ut.getInstance().clear(),Kt.getInstance().clear(),$t.getInstance().clear(),Qt.getInstance().clear(),Xt.getInstance().clear(),Yt.getInstance().clear(),Zt.getInstance().clear(),en.getInstance().clear(),nn.getInstance().clear(),sn.reset()}var In="DETECT_KEY__ENABLE",yn="DETECT_KEY__AUTO_START",kn=function(e){return e[e.Start=0]="Start",e[e.Stop=1]="Stop",e[e.Finish=2]="Finish",e}({});class wn extends i{constructor(...e){var n;super(...e),n=this,this.requestId=void 0,this.running=!0,this.interval=2e3,this.supportGamePerformance=!1,this.getGamePerformance=void 0,this.getAndDispatchPerformanceData=t()((function*(){if(n.running){var[,e]=yield y(n.postGetGamePerformance());e&&n.enable&&(delete e.errMsg,E.emit(F.Received,new ee(e))),n.running&&(n.requestId=setTimeout((()=>{n.getAndDispatchPerformanceData()}),n.interval))}}))}get enable(){return bn.isRunning&&this.supportGamePerformance}init(e){e?(this.supportGamePerformance=!0,this.getGamePerformance=e):this.supportGamePerformance=!1}start(){this.enable&&(this.running=!0,this.getAndDispatchPerformanceData())}stop(){this.running=!1,this.requestId&&clearTimeout(this.requestId)}postGetGamePerformance(){return this.getGamePerformance?new Promise(((e,t)=>{var n;null===(n=this.getGamePerformance)||void 0===n||n.call(this,{success:e,fail:t})})):Promise.reject()}}const bn=class extends i{constructor(...e){super(...e),this.enable=!1,this.isRunning=!1,this.injectMode=!1,this.autoStart=!1,this.deviceInfo=void 0,this.result=void 0,this.inited=!1,this.start=()=>{var e,t,n,r;this.isRunning||(H.isWxApplib&&Ve.report({Type:fe.Info,Target:ve.Launch,ExternInfo:{subpackages:(null===(n=H.sdk.WXConfig)||void 0===n||null===(r=n.subpackages)||void 0===r?void 0:r.length)||0,parallelPreloadSubpackages:H.sdk.WXConfig.parallelPreloadSubpackages,...Ue()}}),this.isRunning=!0,H.detectTimes+=1,$.event("minigame detect logic running!!"),H.meta.startTime=Date.now(),S.init(),Ct.getInstance().init(),Pt.getInstance().init(),xt.getInstance().init(),Rt.getInstance().init(),gn(),wn.getInstance().start(),E.emit(A.Start),null===(e=(t=H.sdk).emitGameAuditStateChange)||void 0===e||e.call(t,{state:kn.Start}))},this.stop=(e=!0)=>{var t,n,r,i;this.isRunning&&(this.isRunning=!1,E.emit(A.BeforeResult),E.emit(A.End),$.event("minigame detect logic stop!!"),H.meta.endTime=Date.now(),function(e=!0){H.isWxApplib&&Ve.report({Type:fe.Info,Target:ve.End,ExternInfo:{detectTime:Date.now()-H.meta.startTime,upload:e,...Ue()}})}(e),null===(t=(n=H.sdk).emitGameAuditStateChange)||void 0===t||t.call(n,{state:kn.Stop}),S.stop(),wn.getInstance().stop(),Ct.getInstance().off(),Pt.getInstance().off(),xt.getInstance().off(),Rt.getInstance().off(),mn(),e?on.getInstance().uploadReport().then((()=>{var e;this.reset(),null!=H&&null!==(e=H.audits)&&void 0!==e&&e.systemDescription&&this.hideUI()})).catch((()=>{an.getInstance().hideLoading(),an.getInstance().showLoading("报告生成失败"),setTimeout((()=>{an.getInstance().hideLoading()}),2e3)})).finally((()=>{var e,t;null===(e=(t=H.sdk).emitGameAuditStateChange)||void 0===e||e.call(t,{state:kn.Finish})})):null===(r=(i=H.sdk).emitGameAuditStateChange)||void 0===r||r.call(i,{state:kn.Finish}))}}init(e){var t,n;($.event("minigame detect tool inject!!"),$.debug("minigame detect tool inject!!, initParams=",e),H.init(e),Ve=new Oe,function(e){if(e){var t=(f=e).getFileSystemManager();s=t.writeFile,o=t.unlink,a=f.showModal,l=f.showLoading,h=f.hideLoading,c=f.getSystemInfoSync,u=f.getDeviceInfo(),d=f.getAppBaseInfo()}}(e.globalWx),H.isWxApplib?(this.enable=!0,this.autoStart=H.audits.autoStart):this.handleLaunchConfig(),$.event(`enable=${this.enable}, autoStart=${this.autoStart}`),this.enable&&(this.beforeStart(),this.generateDetectTask(),this.autoStart&&this.start()),t={request:e.request,uploadFile:e.uploadFile,gameTransfer:e.gameTransfer},tt=t.request?t.request:p().request,nt=t.uploadFile?t.uploadFile:p().uploadFile,Je(t),e.gameAuditModule)&&("function"==typeof(null===(n=e.gameAuditModule)||void 0===n?void 0:n.onAuditInject)&&e.gameAuditModule.onAuditInject(this));this.inited=!0}generateDetectTask(){return t()((function*(){on.getInstance().getDeviceInfo()}))()}handleLaunchConfig(){this.injectMode=!1;var e={};this.enable=!!e[In],this.autoStart=!!e[yn]}registerDetectEvent(){E.once(A.Start,this.start),E.once(A.End,this.stop)}beforeStart(){var{coverview:e,getGamePerformance:t}=H.initParams;pn(),H.isWxApplib&&(an.getInstance().init(e),wn.getInstance().init(t))}reset(){on.getInstance().reset(),H.reset(),vn(),S.reset(),Ct.getInstance().reset(),Pt.getInstance().reset(),xt.getInstance().reset(),Rt.getInstance().reset(),Q.reset(),rn.reset()}showUI(){an.getInstance().initReadyPromise.then((()=>{an.getInstance().triggerBtnStatus(!0),an.getInstance().triggerUIVisible(!0)}))}hideUI(){an.getInstance().initReadyPromise.then((()=>{an.getInstance().triggerUIVisible(!1),an.getInstance().triggerBtnStatus(!1)}))}showConfirm(){an.getInstance().initReadyPromise.then((()=>{an.getInstance().showConfirm()}))}}.getInstance();Object.defineProperty(globalThis,"__GamePerformanceUtilsSDK",{get:()=>({getSDK:()=>({controller:bn})})});const Tn=bn})(),r.default})()}()}catch(e){console.error("catch sdkSubPackage: gamePerformanceUtilsSDK error: ",e)}