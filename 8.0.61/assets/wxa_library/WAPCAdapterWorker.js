(()=>{"use strict";var e={20786:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.JSBridge=void 0;const t="[JSBridge]";r.JSBridge=class{#e;#r;constructor(e,r){this.#e=e,this.#r=r}bindGlobal(e){this.#r=e}get global(){if(!this.#r)throw new Error("JSBridge not bind to global");return this.#r}sendCallback(e,r){this.global.WeixinJSBridge.invokeCallbackHandler(e,r)}sendThirdCallback(e,r){this.#e.invokeThirdHandler?this.global.WeixinJSBridge.invokeThirdCallbackHandler(e,r):console.warn(t,`sendThirdCallback ${e} fail: no handler`)}#t(e,r,t){this.global.WeixinJSBridge.subscribeHandler(e,this.#e.condom?this.#e.condom(r,this.global):r,t,{nativeTime:Date.now()})}dispatchEvent(e,r,t=0){this.#t(e,r,t)}dispatchThirdEvent(e,r){this.#e.invokeThirdHandler?this.global.WeixinJSBridge.subscribeThirdHandler(e,this.#e.condom?this.#e.condom(r,this.global):r):console.warn(t,`dispatchThirdEvent ${e} fail: no handler`)}publish(e,r,i=0){this.#e.publishHandler?this.#t(e,r,i):console.warn(t,`publish ${e} fail: no handler`)}get WeixinJSCore(){const e=this;return{invokeHandler(...r){e.#e.invokeHandler.apply(e,r)},publishHandler(...r){e.#e.publishHandler?e.#e.publishHandler.apply(e,r):console.warn(t,`publish ${r[0]} fail: no handler`)},invokeThirdHandler(...r){e.#e.invokeThirdHandler?e.#e.invokeThirdHandler.apply(e,r):console.warn(t,`invokeThird ${r[0]} fail: no handler`)}}}}},52594:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SingleEventEmitter=r.EventEmitter=void 0;class t{#i=new Map;static#a;static setOnError(e){t.#a=e}emit(e,r){const i=this.#i.get(e);if(i&&i.size>0){for(const a of i)try{a(r)}catch(r){if(t.#a)try{t.#a(r,e,this)}catch(e){console.error(e)}else console.error(r)}return!0}return!1}on(e,r){const t=this.#i.get(e);return t?t.add(r):this.#i.set(e,new Set([r])),this}off(e,r){const t=this.#i.get(e);t&&(void 0===r?this.#i.delete(e):(t.delete(r),0===t.size&&this.#i.delete(e)))}clearListeners(){this.#i.clear()}}r.EventEmitter=t,r.SingleEventEmitter=class{#i=new Set;emit(e){const r=this.#i;for(const t of r)t(e);return r.size>0}on(e){return this.#i.add(e),this}off(e){this.#i.delete(e)}offAll(){this.#i.clear()}}},43766:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.safeGlobals=void 0,r.safeGlobals=new Set(["Object","Function","Array","Number","parseFloat","parseInt","Infinity","NaN","undefined","Boolean","String","Symbol","Date","Promise","PromiseRejectionEvent","RegExp","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError","JSON","Math","console","ArrayBuffer","Uint8Array","Int8Array","Uint16Array","Int16Array","Uint32Array","Int32Array","Float32Array","Float64Array","Uint8ClampedArray","BigUint64Array","BigInt64Array","DataView","Map","BigInt","Set","WeakMap","WeakSet","WeakRef","FinalizationRegistry","Proxy","Reflect","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","unescape","isFinite","isNaN","SharedArrayBuffer","Atomics","WebAssembly","globalThis","clearInterval","clearTimeout","setInterval","setTimeout","WeixinWorker","WeixinJSBridge","__wxConfig","NativeGlobal"])},9530:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clearGlobal=void 0;const i=t(43766);r.clearGlobal=function(e,r){Object.getOwnPropertyNames(e).forEach((e=>{r.has(e)||i.safeGlobals.has(e)||delete self[e]}))}},56771:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WMPFWorkerClient=void 0;const i=t(52594),a="[WorkerClient]";class n extends i.EventEmitter{ctxGlobal;constructor(e){super(),this.ctxGlobal=e}handleMessage(e){let r=!1,t="app";try{switch(e.cmd){case"msg":this.emit("appMsg",e.data);break;case"init":{const{__wxConfig:i,libScripts:n}=e;r=e.preload,t=e.type,i.preload=r,i.workerContentType=t,i.wmpfDirectInvokeJs=!0,this.ctxGlobal.__wxConfig=i,this.onInit(i),n.forEach((e=>{console.info(a,"inject library in worker",e);try{this.evalLibScript(e)}catch(r){throw console.error(a,`inject library ${e} failed:`,r),r}}));break}case"bind":{const{__wxConfig:t}=e;t&&(t.preload=r,Object.assign(this.ctxGlobal.__wxConfig,t)),this.onBind(e.id,t);break}case"run":{const{appScripts:r}=e;r.forEach((e=>{console.info(a,"inject userScript in worker",e);try{this.evalAppScript(e)}catch(r){throw console.error(a,`inject userScript ${e} failed:`,r),r}}));break}case"cb":this.emit("callback",{id:e.id,data:e.data});break;case"event":this.emit("event",{name:e.name,data:e.data});break;default:console.warn(a,"unknown message:",e)}}catch(r){console.error(a,"handle message failed:",r,e)}}postAppMessage(e){this.postMessage({cmd:"msg",data:e})}invokeHandler(e,r,t,i){this.postMessage({cmd:"api",id:t,name:e,args:r,privArgs:i})}}r.WMPFWorkerClient=n},14941:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.injectWorkerGlobals=void 0;const i=t(20786),a=t(733);r.injectWorkerGlobals=function(e){const r=e.ctxGlobal,t=new i.JSBridge({invokeHandler(r,t,i,a){e.invokeHandler(r,t,i,a)}},r);return e.on("appMsg",(e=>{e=(0,a.parseMessage)(e),r.WeixinWorker.appServiceMsgHandler(e)})).on("callback",(({id:e,data:r})=>{t.sendCallback(e,r)})).on("event",(({name:e,data:r})=>{t.dispatchEvent(e,r)})),Object.assign(r,{workerInvokeJsApi:t.WeixinJSCore.invokeHandler,WeixinWorker:{postMsgToAppService(r){e.postAppMessage(r)},WebAssembly}})}},71074:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WebWorkerClient=void 0;const i=t(9530),a=t(56771),n=self.postMessage,o=self;class s extends a.WMPFWorkerClient{constructor(){super(globalThis),o.addEventListener("message",(e=>{this.handleMessage(e.data)}))}onInit(){(0,i.clearGlobal)(self,new Set(["workerInvokeJsApi"])),Object.assign(self,{GameGlobal:{},eval:()=>{}})}onBind(e,r){}postMessage(e){n(e)}evalAppScript(e){importScripts(e)}evalLibScript(e){importScripts(e)}}r.WebWorkerClient=s},733:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.parseMessage=void 0,r.parseMessage=function(e){if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.warn("[WxWorker]","parse JSON string failed:",e)}return e}}},r={};function t(i){var a=r[i];if(void 0!==a)return a.exports;var n=r[i]={exports:{}};return e[i](n,n.exports,t),n.exports}(()=>{const e=t(71074),r=t(14941);globalThis.NativeGlobal={OffscreenCanvas:globalThis.OffscreenCanvas},(0,r.injectWorkerGlobals)(new e.WebWorkerClient)})()})();